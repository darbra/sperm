> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [blog.mythsman.com](https://blog.mythsman.com/post/60d1a161e8493b525875166c/#%E5%AE%9E%E6%88%98-%E6%9F%90%E9%9F%B3)

> å‰è¨€ å‰ä¸¤å¤©å’Œéš”å£åšé£æ§çš„åŒå­¦èŠå¤©ï¼Œæ®è¯´ä»–ä»¬ç»å¸¸ä½¿ç”¨æµè§ˆå™¨æŒ‡çº¹æ¥è¯†åˆ«å’Œæ ‡è®°çˆ¬è™«ï¼ˆå½“ç„¶å…·ä½“çš„ç»†èŠ‚æ˜¯ä¸èƒ½é€éœ²çš„ï¼‰ï¼Œè”æƒ³åˆ°æˆ‘ä»¬æœ€è¿‘ä¹Ÿç»å¸¸é‡åˆ°è¢«é£æ§çš„æƒ…å†µï¼Œäºæ˜¯å°±èŠ±äº†ç‚¹æ—¶é—´ç ”ç©¶ä¸‹æµè§ˆå™¨æŒ‡çº¹ç›¸å…³çš„çŸ¥è¯†ã€‚

å‰ä¸¤å¤©å’Œéš”å£åšé£æ§çš„åŒå­¦èŠå¤©ï¼Œæ®è¯´ä»–ä»¬ç»å¸¸ä½¿ç”¨æµè§ˆå™¨æŒ‡çº¹æ¥è¯†åˆ«å’Œæ ‡è®°çˆ¬è™«ï¼ˆå½“ç„¶å…·ä½“çš„ç»†èŠ‚æ˜¯ä¸èƒ½é€éœ²çš„ï¼‰ï¼Œè”æƒ³åˆ°æˆ‘ä»¬æœ€è¿‘ä¹Ÿç»å¸¸é‡åˆ°è¢«é£æ§çš„æƒ…å†µï¼Œäºæ˜¯å°±èŠ±äº†ç‚¹æ—¶é—´ç ”ç©¶ä¸‹æµè§ˆå™¨æŒ‡çº¹ç›¸å…³çš„çŸ¥è¯†ã€‚

éœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œâ€œ**éšè—æµè§ˆå™¨æŒ‡çº¹**â€ å’Œ â€œ**éšè— Webdriver/Selenium/Puppeteer**â€ã€â€œ**åŒ¿åæµè§ˆ**â€ éƒ½ä¸æ˜¯åŒä¸€ä¸ªé—®é¢˜ã€‚â€œéšè— Webdriver/Selenium/Puppeteerâ€ çš„ç›®çš„æ˜¯å‘Šè¯‰æœåŠ¡ç«¯è‡ªå·±ä¸æ˜¯è‡ªåŠ¨åŒ–çˆ¬è™«ï¼ˆè¿™ä¸ªä¼¼ä¹å¯ä»¥å°è¯•ç”¨ [stealth.min.js](https://github.com/berstend/puppeteer-extra/blob/master/packages/extract-stealth-evasions/readme.md) æ¥åšï¼‰ï¼›â€œåŒ¿åæµè§ˆâ€ çš„ç›®çš„æ˜¯ä¸è®©æµè§ˆè®°å½•åœ¨æœ¬åœ°ç•™ä¸‹ç—•è¿¹ï¼ˆè¿™ä¸ªå¯ä»¥ç”¨æµè§ˆå™¨çš„åŒ¿åæ¨¡å¼æ¥å®ç°ï¼‰ï¼›â€œéšè—æµè§ˆå™¨æŒ‡çº¹â€ æ˜¯ä¸ºäº†ä¸è®©æœåŠ¡ç«¯è¿½è¸ª â€œç°åœ¨çš„æˆ‘å’Œä¹‹å‰çš„æˆ‘æ˜¯åŒä¸€ä¸ªæˆ‘â€ï¼ˆè¿™ä¸ªæ˜¯æˆ‘ä»¬è¿™æ¬¡æƒ³è§£å†³çš„é—®é¢˜ï¼‰ã€‚

æµè§ˆå™¨æŒ‡çº¹ä¸€èˆ¬æ˜¯é€šè¿‡ Javascript èƒ½æå–æˆ–è®¡ç®—å¾—åˆ°çš„ä¸€äº›å…·æœ‰ä¸€å®š**ç¨³å®šæ€§**å’Œ**ç‹¬ç‰¹æ€§**çš„å‚æ•°ã€‚é£æ§çš„åŒå­¦å°†è¿™äº›å‚æ•°åšä¸€å®šå–èˆå’Œç»„åˆï¼Œå°±èƒ½å¾—åˆ°ä¸€å°æµè§ˆå™¨çš„å¤§è‡´æ ‡è¯†ã€‚åœ¨æ²¡æœ‰å¼ºåˆ¶ç™»é™†çš„æƒ…å†µä¸‹ï¼Œæœ‰äº†è¿™ä¸ªæ ‡è¯†ï¼Œé£æ§çš„åŒå­¦å¯ä»¥åšåçˆ¬ã€å¹¿å‘Šçš„åŒå­¦å¯ä»¥åšæ¨èã€æ•°æ®çš„åŒå­¦å¯ä»¥ç®— uv ç­‰ç­‰ï¼Œç”¨å¤„è¿˜æ˜¯ä¸å°çš„ã€‚

å¸¸è§çš„æµè§ˆå™¨æŒ‡çº¹ä¼šæå–å¦‚ä¸‹ä¸œè¥¿ï¼š

1.  UserAgent å’Œå¹³å°ä¿¡æ¯
2.  æµè§ˆå™¨åŠ è½½çš„å­—ä½“ä¿¡æ¯
3.  å£°å¡æŒ‡çº¹
4.  Canvas æŒ‡çº¹
5.  æ˜¾ç¤ºå™¨åˆ†è¾¨ç‡
6.  è¯­è¨€ã€åœ°åŒºæ—¶åŒºä¿¡æ¯
7.  CPU æ ¸æ•°å’Œå¯ç”¨å†…å­˜ä¿¡æ¯
8.  æœ¬åœ°å­˜å‚¨ã€Cookie ç­‰ä¿¡æ¯
9.  æµè§ˆå™¨å®‰è£…çš„æ’ä»¶ä¿¡æ¯
10.  ç§‘å­¦è®¡ç®—çš„æŒ‡çº¹ä¿¡æ¯
11.  IP å’Œä»£ç†ä¿¡æ¯

å¯ä»¥çœ‹å‡ºæ¥ï¼Œè¿™é‡Œæœ‰çš„æŒ‡æ ‡ç¨³å®šæ€§æ¯”è¾ƒå¥½ï¼Œæ¯”å¦‚ UserAgentã€åˆ†è¾¨ç‡ã€åœ°åŒºã€è¯­è¨€ã€å­—ä½“ä¿¡æ¯ç­‰ï¼Œä½†æ˜¯è¿™äº›æŒ‡æ ‡é€šå¸¸åŒºåˆ†åº¦ä¸æ˜¯å¾ˆå¥½ã€‚å› æ­¤æˆ‘ä»¬é€šå¸¸æ›´å–œæ¬¢ç”¨ä¸€äº›ç¡¬ä»¶æŒ‡çº¹ä¿¡æ¯æ¥è¿›è¡ŒåŒºåˆ†ã€‚å½“ç„¶ï¼Œä¸ºäº†è¡¡é‡æŒ‡æ ‡çš„è¿™ç§ â€œ**ç‹¬ç‰¹æ€§**â€ï¼Œ[Peter Eckersley](https://pde.is/) æå‡ºäº†ç”¨ä¸€ä¸ªæŒ‡æ ‡å¯¹è®¾å¤‡å”¯ä¸€æŒ‡çº¹å¼•å…¥çš„ç†µæ¥è¡¡é‡æŒ‡æ ‡çš„è¿™ç§ç‰¹æ€§ï¼Œä¸‹é¢æ˜¯æˆ‘çš„è®¾å¤‡åœ¨ [coveryyourtracks](https://coveryourtracks.eff.org/) ä¸­è·‘å‡ºæ¥çš„ä¸€äº›å¸¸è§æŒ‡æ ‡çš„æ•ˆæœï¼š

```
USER AGENT
Bits of identifying information: 9.04
One in x browsers have this value: 524.71
 
HTTP_ACCEPT HEADERS
Bits of identifying information: 8.96
One in x browsers have this value: 496.75
 
BROWSER PLUGIN DETAILS
Bits of identifying information: 3.25
One in x browsers have this value: 9.54
 
TIME ZONE OFFSET
Bits of identifying information: 5.26
One in x browsers have this value: 38.38
 
TIME ZONE
Bits of identifying information: 6.83
One in x browsers have this value: 114.13
 
SCREEN SIZE AND COLOR DEPTH
Bits of identifying information: 6.28
One in x browsers have this value: 77.57
 
SYSTEM FONTS
Bits of identifying information: 3.92
One in x browsers have this value: 15.12
 
ARE COOKIES ENABLED?
Bits of identifying information: 0.13
One in x browsers have this value: 1.09
 
LIMITED SUPERCOOKIE TEST
Bits of identifying information: 1.41
One in x browsers have this value: 2.67
 
HASH OF CANVAS FINGERPRINT
Bits of identifying information: 9.73
One in x browsers have this value: 847.61
 
HASH OF WEBGL FINGERPRINT
Bits of identifying information: 9.75
One in x browsers have this value: 862.69
 
WEBGL VENDOR & RENDERER
Bits of identifying information: 8.5
One in x browsers have this value: 362.9
 
DNT HEADER ENABLED?
Bits of identifying information: 0.95
One in x browsers have this value: 1.93
 
LANGUAGE
Bits of identifying information: 7.47
One in x browsers have this value: 176.69
 
PLATFORM
Bits of identifying information: 3.11
One in x browsers have this value: 8.62
 
TOUCH SUPPORT
Bits of identifying information: 0.76
One in x browsers have this value: 1.7
 
AD BLOCKER USED
Bits of identifying information: 0.15
One in x browsers have this value: 1.11
 
AUDIOCONTEXT FINGERPRINT
Bits of identifying information: 5.92
One in x browsers have this value: 60.59
 
CPU CLASS
Bits of identifying information: 0.12
One in x browsers have this value: 1.09
 
HARDWARE CONCURRENCY
Bits of identifying information: 1.93
One in x browsers have this value: 3.82
 
DEVICE MEMORY (GB)
Bits of identifying information: 2.31
One in x browsers have this value: 4.96

```

å…¶ä¸­ï¼Œâ€œBits of identifying informationâ€ è¡¨ç¤ºè¿™ä¸ªæŒ‡æ ‡å¯¹æˆ‘çš„æµè§ˆå™¨å¼•å…¥çš„å”¯ä¸€æ€§çš„ä½æ•°ï¼Œè¿™ä¸ªä½æ•°è¶Šå¤§ï¼Œè¶Šè¡¨æ˜è¿™ä¸ªæŒ‡æ ‡æ›´èƒ½åŒºåˆ†æˆ‘çš„æµè§ˆå™¨å’Œå…¶ä»–çš„æµè§ˆå™¨ï¼›â€œOne in x browsers have this valueâ€ è¡¨ç¤ºå¹³å‡å¤šå°‘ä¸ªæµè§ˆå™¨çš„è¿™ä¸ªæŒ‡æ ‡å’Œæˆ‘çš„æµè§ˆå™¨çš„è¿™ä¸ªæŒ‡æ ‡ä¸€æ ·ï¼Œè¿™ä¸ªæ•°è¶Šå¤§ï¼Œè¶Šè¡¨æ˜è¿™ä¸ªæŒ‡æ ‡çš„åŒºåˆ†åº¦å¥½ã€‚

æ˜¾ç„¶ï¼Œä»è¿™é‡Œçœ‹ï¼ŒåŒºåˆ†åº¦æœ€é«˜çš„æŒ‡æ ‡å°±æ˜¯ "UserAgent" , "WebGL æŒ‡çº¹" å’Œ "Canvas æŒ‡çº¹" ã€‚é‚£è¿™äº›æŒ‡çº¹æ˜¯æ€ä¹ˆ work çš„å‘¢ï¼Ÿä¾‹å¦‚ Canvas æŒ‡çº¹ï¼Œå…¶å®å°±æ˜¯ç”±äº Web æµè§ˆå™¨ä½¿ç”¨çš„å›¾åƒå¤„ç†å¼•æ“ã€å›¾åƒå¯¼å‡ºé€‰é¡¹ã€å‹ç¼©çº§åˆ«ã€æ“ä½œç³»ç»Ÿçš„å­—ä½“ï¼ŒæŠ—é”¯é½¿å’Œäºšåƒç´ æ¸²æŸ“ç®—æ³•ç­‰çš„ä¸åŒï¼Œå¯¼è‡´ç”»å‡ºæ¥çš„å›¾ç‰‡åœ¨åƒç´ çº§åˆ«å­˜åœ¨çš„å¾®å°ä½†ç¨³å®šçš„å·®è·ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ‹¿è¿™ä¸ªç”Ÿæˆå›¾ç‰‡çš„æ ¡éªŒå’Œæˆ–ç®—ä¸€ä¸ª Hash ä½œä¸ºä»–çš„æŒ‡çº¹ã€‚

ç›®å‰ä¸šå†…è¾ƒä¸ºçŸ¥åçš„æµè§ˆå™¨æŒ‡çº¹æ£€æµ‹ç½‘ç«™å¤§æ¦‚æœ‰ä¸‹é¢è¿™ä¸‰ä¸ªï¼š

1.  [https://fingerprintjs.github.io/fingerprintjs/](https://fingerprintjs.github.io/fingerprintjs/)
2.  [http://f.vision/](http://f.vision/)
3.  [https://coveryourtracks.eff.org/](https://coveryourtracks.eff.org/)

ç¬¬ä¸€ä¸ªæ˜¯æœ€å¸¸è§çš„æµè§ˆå™¨æŒ‡çº¹ç”Ÿæˆé¡¹ç›®ï¼Œä¹‹å‰æŸæ‰‹ç”¨è¿‡ä¸€æ®µæ—¶é—´ï¼Œåæ¥å¥½åƒä¸ç”¨äº†ï¼Œå¯ä»¥ä½œä¸ºå…¥é—¨é¡¹ç›®æ¥çœ‹ã€‚

ç¬¬äºŒä¸ªæ˜¯ä¸€ä¸ªè¿›é˜¶çš„åœ¨çº¿æ£€æµ‹æŒ‡çº¹çš„ç½‘ç«™ï¼Œæ£€æµ‹ç‚¹æ›´å…¨ï¼Œä¹Ÿæœ‰ä¸€å®šçš„åä¼ªé€ èƒ½åŠ›ã€‚

ç¬¬ä¸‰ä¸ªæ˜¯ [Peter Eckersley](https://pde.is/) å®éªŒç”¨çš„æ£€æµ‹æŒ‡çº¹çš„ç½‘ç«™ï¼Œæ•™è‚²æ„ä¹‰æ›´æ˜æ˜¾ï¼Œä¹Ÿæœ‰ä¸€å®šçš„åä¼ªé€ èƒ½åŠ›ã€‚

æœ‰çŸ›å°±æœ‰ç›¾ï¼Œä½œä¸ºï¼ˆçˆ¬è™«ï¼‰æ™®é€šç”¨æˆ·ï¼Œæˆ‘ä»¬æ˜¾ç„¶ä¸æƒ³è®©æœåŠ¡ç«¯è·Ÿè¸ªæˆ‘ä»¬çš„æ“ä½œè·¯å¾„ï¼Œä½†åˆä¸æƒ³ç”¨ [Tor](https://www.torproject.org/) æµè§ˆå™¨ã€‚å› æ­¤æˆ‘ä»¬å°±è¦æƒ³ä¸€äº›å¯¹ä»˜è¿™äº›æŒ‡çº¹æ£€æµ‹çš„åŠæ³•ã€‚ä¸‹é¢å°±æ˜¯æˆ‘åšçš„ä¸€äº›å°è¯•ã€‚

æŒ‡çº¹ç”Ÿæˆç®—æ³•
------

é¦–å…ˆæˆ‘ä»¬å…ˆçœ‹ä¸‹ fingerprintjs æ£€æµ‹ Canvas æŒ‡çº¹çš„æ ¸å¿ƒä»£ç ï¼Œä½œä¸ºæˆ‘ä»¬é¦–å…ˆéœ€è¦ç»•è¿‡çš„ç›®æ ‡ï¼š

```
function makeTextImage(canvas, context) {
    
    canvas.width = 240;
    canvas.height = 60;
    context.textBaseline = 'alphabetic';
    context.fillStyle = '#f60';
    context.fillRect(100, 1, 62, 20);
    context.fillStyle = '#069';
    
    
    context.font = '11pt "Times New Roman"';
    
    
    
    
    
    
    var printedText = "Cwm fjordbank gly " + String.fromCharCode(55357, 56835) ;
    context.fillText(printedText, 2, 15);
    context.fillStyle = 'rgba(102, 204, 0, 0.2)';
    context.font = '18pt Arial';
    context.fillText(printedText, 4, 45);
    return save(canvas);
}
function makeGeometryImage(canvas, context) {
    
    canvas.width = 122;
    canvas.height = 110;
    
    
    
    context.globalCompositeOperation = 'multiply';
    for (var _i = 0, _a = [
        ['#f2f', 40, 40],
        ['#2ff', 80, 40],
        ['#ff2', 60, 80],
    ]; _i < _a.length; _i++) {
        var _b = _a[_i], color = _b[0], x = _b[1], y = _b[2];
        context.fillStyle = color;
        context.beginPath();
        context.arc(x, y, 40, 0, Math.PI * 2, true);
        context.closePath();
        context.fill();
    }
    
    
    
    context.fillStyle = '#f9c';
    context.arc(60, 60, 60, 0, Math.PI * 2, true);
    context.arc(60, 60, 20, 0, Math.PI * 2, true);
    context.fill('evenodd');
    return save(canvas);
}

```

è¿™é‡Œä¸»è¦ç”Ÿæˆäº†ä¸‹é¢ä¸¤ä¸ªä¸œè¥¿ï¼š

æŒ‡å®šå½¢çŠ¶ã€å­—ä½“ã€æ–‡å­—ã€é¢œè‰²ç­‰ï¼Œç”»äº†ä¸€ä¸ªå›¾ã€‚

![](https://blog.mythsman.com/content/images/2021/06/image-9.png)

æŒ‡å®šäº†é¢œè‰²ã€ä½ç½®ï¼Œç”»äº†ä¸€äº›å¥‡å¥‡æ€ªæ€ªçš„åœ†å¼§ã€‚

![](https://blog.mythsman.com/content/images/2021/06/image-10.png)

ç„¶å fingerprintjs ä¼šç”¨è¿™ä¸¤ä¸ªå›¾ï¼Œæ ¹æ® murmurHash3 ç®—ä¸€ä¸ªæŒ‡çº¹ã€‚

Canvas Fingerprint Defender
---------------------------

Chrome æœ‰ä¸€ä¸ªå£°ç§°èƒ½é˜²æ­¢ canvas æŒ‡çº¹æ³„éœ²çš„æ’ä»¶ [Canvas Fingerprint Defender](https://chrome.google.com/webstore/detail/canvas-fingerprint-defend/lanfdkkpgfjfdikkncbnojekcppdebfp) ï¼Œæˆ‘ä»¬å§‘ä¸”æ‹¿ä»–æ¥æ£€æµ‹ç»•è¿‡ fingerprintjs çœ‹çœ‹ã€‚

å®‰è£…åï¼Œæ‰¾åˆ° crx å®‰è£…ç›®å½•ï¼Œå‘ç°ä»–çš„é€»è¾‘ä¸»è¦æ˜¯åœ¨ `data/content_script/inject.js` ä¸­ï¼Œæ ¸å¿ƒé€»è¾‘å¦‚ä¸‹ï¼š

```
var inject = function () {
  const toBlob = HTMLCanvasElement.prototype.toBlob;
  const toDataURL = HTMLCanvasElement.prototype.toDataURL;
  const getImageData = CanvasRenderingContext2D.prototype.getImageData;
  
  var noisify = function (canvas, context) {
    if (context) {
      const shift = {
        'r': Math.floor(Math.random() * 10) - 5,
        'g': Math.floor(Math.random() * 10) - 5,
        'b': Math.floor(Math.random() * 10) - 5,
        'a': Math.floor(Math.random() * 10) - 5
      };
      
      const width = canvas.width;
      const height = canvas.height;
      if (width && height) {
        const imageData = getImageData.apply(context, [0, 0, width, height]);
        for (let i = 0; i < height; i++) {
          for (let j = 0; j < width; j++) {
            const n = ((i * (width * 4)) + (j * 4));
            imageData.data[n + 0] = imageData.data[n + 0] + shift.r;
            imageData.data[n + 1] = imageData.data[n + 1] + shift.g;
            imageData.data[n + 2] = imageData.data[n + 2] + shift.b;
            imageData.data[n + 3] = imageData.data[n + 3] + shift.a;
          }
        }
        
        window.top.postMessage("canvas-fingerprint-defender-alert", '*');
        context.putImageData(imageData, 0, 0);
      }
    }
  };
  
  Object.defineProperty(HTMLCanvasElement.prototype, "toBlob", {
    "value": function () {
      noisify(this, this.getContext("2d"));
      return toBlob.apply(this, arguments);
    }
  });
  
  Object.defineProperty(HTMLCanvasElement.prototype, "toDataURL", {
    "value": function () {
      noisify(this, this.getContext("2d"));
      return toDataURL.apply(this, arguments);
    }
  });
  
  Object.defineProperty(CanvasRenderingContext2D.prototype, "getImageData", {
    "value": function () {
      noisify(this.canvas, this);
      return getImageData.apply(this, arguments);
    }
  });
  
  document.documentElement.dataset.cbscriptallow = true;
};
inject();

```

ä»£ç åŸºæœ¬ä¸ç”¨è§£é‡Šï¼Œä¸»è¦å°±åšäº†ä¸€ä»¶äº‹æƒ…ï¼šé‡å†™ Canvas çš„ toBlobï¼ŒtoDataURL æ–¹æ³•å’Œ Context çš„ getImageData æ–¹æ³•ï¼Œä½¿ä»–ä»¬åœ¨ç”Ÿæˆå›¾ç‰‡æ—¶åŠ ä¸€äº›å™ªç‚¹ã€‚

é€šè¿‡ä¸‹é¢çš„ selenium ä»£ç æ³¨å…¥ä¸Šè¿°è„šæœ¬ï¼š

```
from selenium import webdriver
from selenium.webdriver.chrome.options import Options
 
options = Options()
 
driver = webdriver.Chrome(options=options, executable_path="/path/to/chromedriver")
 
f = open('./inject.js')
js = f.read()
driver.execute_cdp_cmd("Page.addScriptToEvaluateOnNewDocument", {"source": js})
 
driver.get('https://fingerprintjs.github.io/fingerprintjs/')

```

è¿ç»­è·‘ä¸¤æ¬¡ï¼Œå‘ç°æŒ‡çº¹çš„ç¡®å¹¶ä¸ç›¸åŒï¼š

![](https://blog.mythsman.com/content/images/2021/06/image-19.png)![](https://blog.mythsman.com/content/images/2021/06/image-20.png)

ä½†æ˜¯ä¸Šé¢çš„è„šæœ¬å¦‚æœåº”ç”¨åœ¨ f.vision ä¸Šï¼ˆæˆ–è€… Â [canvas-fingerprint](https://webbrowsertools.com/canvas-fingerprint/) ï¼‰ï¼Œè™½ç„¶ä¹Ÿä¼šç”Ÿæˆä¸åŒçš„æŒ‡çº¹ï¼Œä½†æ˜¯ä¼šå‘ç°æœ‰ä¸‹é¢çš„ç»“æœï¼š

![](https://blog.mythsman.com/content/images/2021/06/image-27.png)

æœ‰æ„æ€ï¼Œæœç„¶æ˜¯åšäº†ä¸€äº›æ£€æµ‹ï¼Œè®©æˆ‘ä»¬æ‘˜ä¸‹é¢å…·çœ‹çœ‹ä»–åšäº†å•¥ã€‚ä¸€ç•ªæœç´¢åå‘ç°äº†å¦‚ä¸‹æ£€æµ‹ç‚¹ã€‚

æ£€æµ‹ç‚¹ä¸€
----

```
CanvasRenderingContext2D.prototype.getImageData.length !== 4 
|| !CanvasRenderingContext2D.prototype.getImageData.toString().match(/^\s*function getImageData\s*\(\)\s*\{\s*\[native code\]\s*\}\s*$/) 
|| (CanvasRenderingContext2D.prototype.getImageData.name !== "getImageData" && !ie)

```

åŸæ¥ä»– check äº†ä¸€ä¸‹å…³é”®å¯¹è±¡çš„ prototype çš„å±æ€§ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å½“å‰å®é™…çš„ç»“æœï¼š

```
CanvasRenderingContext2D.prototype.getImageData.length
0
 
CanvasRenderingContext2D.prototype.getImageData.toString()
"function () {\n      noisify(this.canvas, this);\n      return getImageData.apply(this, arguments);\n    }"
 
CanvasRenderingContext2D.prototype.getImageData.name
"value"

```

è¿™é‡Œæœç„¶å’Œæ²¡æœ‰æ”¹è¿‡çš„ä¸ä¸€æ ·ã€‚

æ£€æµ‹ç‚¹äºŒ
----

```
function cKnownPixels(size) {
    "use strict";
 
    var canvas = document.createElement("canvas");
    canvas.height = size;
    canvas.width = size;
    var context = canvas.getContext("2d");
    if (!context)
        return false;
 
    context.fillStyle = "rgba(0, 127, 255, 1)";
    var pixelValues = [0, 127, 255, 255];
    context.fillRect(0, 0, canvas.width, canvas.height);
    var p = context.getImageData(0, 0, canvas.width, canvas.height).data;
    for (var i = 0; i < p.length; i += 1) {
        if (p[i] !== pixelValues[i % 4]) {
            return false;
        }
    }
    return true;
}

```

è¿™ä¸ªæ˜¯ä¸ªå¾ˆå®¹æ˜“æƒ³åˆ°çš„æ£€æµ‹æ–¹æ³•ï¼Œè¾“å…¥ä¸€ä¸ªå·²çŸ¥çš„ç¨³å®šåƒç´ å›¾ï¼ˆç”±äºä¸å­˜åœ¨å­—ä½“ã€å¤æ‚è®¡ç®—ç­‰ï¼Œå› æ­¤ä¸åŒæœºå™¨çš„æ¸²æŸ“å‡ ä¹ä¸ä¼šæœ‰å·®å¼‚ï¼‰ï¼Œå¦‚æœè¾“å‡ºçš„ç»“æœå’Œå·²çŸ¥è¾“å…¥ä¸ä¸€æ ·ï¼Œé‚£è‚¯å®šæ˜¯äººä¸ºåŠ äº†å™ªç‚¹ã€‚

æ£€æµ‹ç‚¹ä¸‰
----

```
function cReadOut() {
 
    "use strict";
 
    var canvas = document.createElement("canvas");
    var context = canvas.getContext("2d");
 
    if (!context)
        return false;
 
    var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < imageData.data.length; i += 1) {
        if (i % 4 !== 3) {
            imageData.data[i] = Math.floor(256 * Math.random());
        } else {
            imageData.data[i] = 255;
        }
    }
    context.putImageData(imageData, 0, 0);
 
    var imageData1 = context.getImageData(0, 0, canvas.width, canvas.height);
    var imageData2 = context.getImageData(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < imageData2.data.length; i += 1) {
        if (imageData1.data[i] !== imageData2.data[i]) {
            return false;
        }
    }
    return true;
}

```

è¿™ä¹Ÿæ˜¯ä¸ªæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°çš„æ£€æµ‹æ–¹æ³•ï¼Œå°†åŒä¸€ä»½åƒç´ ç‚¹è¿ç»­è¾“å‡ºä¸¤æ¬¡ï¼Œå¦‚æœè¿™ä¸¤æ¬¡çš„ç»“æœä¸ä¸€æ ·ï¼Œé‚£è‚¯å®šæ˜¯åŠ äº†æŸäº›éšæœºçš„å™ªç‚¹ã€‚

æ£€æµ‹ç‚¹å››
----

```
function cDoubleReadOut() {
 
    "use strict";
 
    var canvas = document.createElement("canvas");
    var context = canvas.getContext("2d");
 
    if (!context)
        return false;
 
    var imageData = context.getImageData(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < imageData.data.length; i += 1) {
        if (i % 4 !== 3) {
            imageData.data[i] = Math.floor(256 * Math.random());
        } else {
            imageData.data[i] = 255;
        }
    }
 
    var imageData1 = context.getImageData(0, 0, canvas.width, canvas.height);
 
    var canvas2 = document.createElement("canvas");
    var context2 = canvas2.getContext("2d");
    context2.putImageData(imageData1, 0, 0);
    var imageData2 = context2.getImageData(0, 0, canvas.width, canvas.height);
 
    for (let i = 0; i < imageData2.data.length; i += 1) {
        if (imageData1.data[i] !== imageData2.data[i]) {
            return false;
        }
    }
    return true;
}

```

å’Œä¸Šé¢çš„æ£€æµ‹æŒºåƒï¼Œä½†æ˜¯æ£€æµ‹å‡ºæ¥çš„ç»“æœæ¯”è¾ƒ trickï¼Œæ²¡å¤ªææ‡‚è¿™æ˜¯æ£€æµ‹çš„å•¥ï¼Œä¸è¿‡å®è·µä¸­å‘ç°å¦‚æœ a é€šé“éšæœºåˆ°çš„å™ªç‚¹åç§»å€¼ä¸å¤ªå¥½ï¼Œå¾ˆå®¹æ˜“æ£€æµ‹ä¸é€šè¿‡ã€‚

å„ä¸ªå‡»ç ´
----

é“é«˜ä¸€å°ºï¼Œé­”é«˜ä¸€ä¸ˆï¼ŒçŸ¥é“ä»–æ˜¯æ€ä¹ˆæ£€æµ‹çš„ï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ‰é’ˆå¯¹æ€§çš„å¤„ç†äº†ã€‚è§£å†³æ€è·¯å¦‚ä¸‹ï¼š

1.  å†æ¬¡ mock å‡ºå¯¹åº” prototype çš„æ­£ç¡® lengthã€toStringã€name å±æ€§ã€‚
2.  å¯¹äºæ²¡æœ‰æ·»åŠ æ–‡å­—ã€æ²¡æœ‰å¤æ‚ä½å›¾å˜æ¢çš„å›¾ï¼Œä¸è¿›è¡Œéšæœºå¡«å……ã€‚
3.  éšæœºå‚æ•°åœ¨å¯åŠ¨æ—¶å°±ç”Ÿæˆä¸”åªç”Ÿæˆä¸€æ¬¡ï¼Œä¿è¯ç›¸åŒçš„å›¾å¤šæ¬¡å¤„ç†ç»“æœä¹Ÿä¸€æ ·ã€‚

å…·ä½“æ“ä½œå¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼š

```
function random(list) {
    let min = 0;
    let max = list.length
    return list[Math.floor(Math.random() * (max - min)) + min];
}
 
let rsalt = random([...Array(7).keys()].map(a => a - 3))
let gsalt = random([...Array(7).keys()].map(a => a - 3))
let bsalt = random([...Array(7).keys()].map(a => a - 3))
let asalt = random([...Array(7).keys()].map(a => a - 3))
 
const rawGetImageData = CanvasRenderingContext2D.prototype.getImageData;
 
let noisify = function (canvas, context) {
    let ctxIdx = ctxArr.indexOf(context);
    let info = ctxInf[ctxIdx];
    const width = canvas.width, height = canvas.height;
    const imageData = rawGetImageData.apply(context, [0, 0, width, height]);
    if (info.useArc || info.useFillText) {
        for (let i = 0; i < height; i++) {
            for (let j = 0; j < width; j++) {
                const n = ((i * (width * 4)) + (j * 4));
                imageData.data[n + 0] = imageData.data[n + 0] + rsalt;
                imageData.data[n + 1] = imageData.data[n + 1] + gsalt;
                imageData.data[n + 2] = imageData.data[n + 2] + bsalt;
                imageData.data[n + 3] = imageData.data[n + 3] + asalt;
            }
        }
    }
    context.putImageData(imageData, 0, 0);
};
 
let ctxArr = [];
let ctxInf = [];
 
(function mockGetContext() {
    let rawGetContext = HTMLCanvasElement.prototype.getContext
 
    Object.defineProperty(HTMLCanvasElement.prototype, "getContext", {
        "value": function () {
            let result = rawGetContext.apply(this, arguments);
            if (arguments[0] === '2d') {
                ctxArr.push(result)
                ctxInf.push({})
            }
            return result;
        }
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.constructor, "length", {
        "value": 1
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.constructor, "toString", {
        "value": () => "function getContext() { [native code] }"
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.constructor, "name", {
        "value": "getContext"
    });
})();
 
(function mockArc() {
    let rawArc = CanvasRenderingContext2D.prototype.arc
    Object.defineProperty(CanvasRenderingContext2D.prototype, "arc", {
        "value": function () {
            let ctxIdx = ctxArr.indexOf(this);
            ctxInf[ctxIdx].useArc = true;
            return rawArc.apply(this, arguments);
        }
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.arc, "length", {
        "value": 5
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.arc, "toString", {
        "value": () => "function arc() { [native code] }"
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.arc, "name", {
        "value": "arc"
    });
})();
 
(function mockFillText() {
    const rawFillText = CanvasRenderingContext2D.prototype.fillText;
    Object.defineProperty(CanvasRenderingContext2D.prototype, "fillText", {
        "value": function () {
            let ctxIdx = ctxArr.indexOf(this);
            ctxInf[ctxIdx].useFillText = true;
            return rawFillText.apply(this, arguments);
        }
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.fillText, "length", {
        "value": 4
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.fillText, "toString", {
        "value": () => "function fillText() { [native code] }"
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.fillText, "name", {
        "value": "fillText"
    });
})();
 
 
(function mockToBlob() {
    const toBlob = HTMLCanvasElement.prototype.toBlob;
 
    Object.defineProperty(HTMLCanvasElement.prototype, "toBlob", {
        "value": function () {
            noisify(this, this.getContext("2d"));
            return toBlob.apply(this, arguments);
        }
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toBlob, "length", {
        "value": 1
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toBlob, "toString", {
        "value": () => "function toBlob() { [native code] }"
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toBlob, "name", {
        "value": "toBlob"
    });
})();
 
(function mockToDataURL() {
    const toDataURL = HTMLCanvasElement.prototype.toDataURL;
    Object.defineProperty(HTMLCanvasElement.prototype, "toDataURL", {
        "value": function () {
            noisify(this, this.getContext("2d"));
            return toDataURL.apply(this, arguments);
        }
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toDataURL, "length", {
        "value": 0
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toDataURL, "toString", {
        "value": () => "function toDataURL() { [native code] }"
    });
 
    Object.defineProperty(HTMLCanvasElement.prototype.toDataURL, "name", {
        "value": "toDataURL"
    });
})();
 
 
(function mockGetImageData() {
    Object.defineProperty(CanvasRenderingContext2D.prototype, "getImageData", {
        "value": function () {
            noisify(this.canvas, this);
            return rawGetImageData.apply(this, arguments);
        }
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.getImageData, "length", {
        "value": 4
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.getImageData, "toString", {
        "value": () => "function getImageData() { [native code] }"
    });
 
    Object.defineProperty(CanvasRenderingContext2D.prototype.getImageData, "name", {
        "value": "getImageData"
    });
})();
 

```

å†ç”¨ selenium è·‘ä¸¤ä¸‹ f.visionï¼Œç»“æœå¦‚ä¸‹ï¼š

![](https://blog.mythsman.com/content/images/2021/06/image-21.png)![](https://blog.mythsman.com/content/images/2021/06/image-22.png)

è¿™ä¸‹è€å®äº†ã€‚

æœ‰äº†ä¸Šé¢çš„èƒ½åŠ›ï¼Œç†è®ºä¸Šæˆ‘ä»¬å°±å¯ä»¥æ‰¾ä¸ªå°ç™½é¼ æ¥å®æˆ˜è¯•éªŒä¸€ä¸‹ã€‚

ä¸‹å›¾æ˜¯æŸéŸ³ç½‘é¡µç‰ˆçš„æ¨èé¡µ https://douyin.com/recommend , æŒ‡çº¹è®¡ç®—çš„é€»è¾‘åœ¨ä»–çš„ **webmssdk.js** ä¸­ï¼Œå…·ä½“é€»è¾‘æ²¡ä»”ç»†çœ‹ï¼Œå§‘ä¸”å½“æˆé»‘ç›’æµ‹è¯•ä¸€ä¸‹ã€‚å¯ä»¥çœ‹åˆ°ä»–ç»™æˆ‘è®¡ç®—äº†ä¸€ä¸ª Canvas æŒ‡çº¹ (å³ canvasHash å˜é‡)ã€‚å¤šæ¬¡æ‰“å¼€ã€æ¸…ç† cookieã€ä½¿ç”¨ä¸åŒæ˜¾ç¤ºå™¨åæŒ‡çº¹å‡èƒ½å¤Ÿä¿æŒç¨³å®šã€‚

![](https://blog.mythsman.com/content/images/2021/09/image-2.png)

ç„¶åä¸Šä¸€ä¸‹æˆ‘ä»¬çš„ä»£ç ï¼Œå¯ä»¥å‘ç°æŒ‡çº¹çš„ç¡®å‘ç”Ÿäº†å˜åŒ–ï¼Œä¸”æ¯æ¬¡æ‰“å¼€å‡ä¸åŒï¼š

![](https://blog.mythsman.com/content/images/2021/09/image-5.png)

æœ¬æ¥ä»¥ä¸ºä¸Šé¢çš„ä»£ç è¶³å¤Ÿåº”å¯¹ç»å¤§å¤šæ•°åœºæ™¯äº†ï¼Œä½†æ˜¯å›å¤´è·‘äº†ä¸€ä¸‹ [https://coveryourtracks.eff.org/](https://coveryourtracks.eff.org/) è¿™ä¸ªï¼ˆæ£€æµ‹æ—¶å¯èƒ½è¦ç¿»å¢™ï¼‰ï¼Œå¿½ç„¶å‘ç°ä»–ç«Ÿç„¶è¿˜æ˜¯èƒ½æ£€æµ‹å‡ºæ¥æˆ‘åšäº†ä¼ªé€ :

![](https://blog.mythsman.com/content/images/2021/06/image-24.png)

å›æƒ³åˆ°ä»–åœ¨æ£€æµ‹æ—¶ä¼¼ä¹æœ‰åˆ·æ–°é¡µé¢çš„æ“ä½œï¼Œå› æ­¤çŒœæµ‹ä»–ä¹Ÿæ˜¯é€šè¿‡åˆ·æ–°é¡µé¢çš„æ–¹å¼ï¼Œæ¯”è¾ƒä¸¤æ¬¡ç”Ÿæˆçš„æŒ‡çº¹æ˜¯å¦ç›¸åŒæ¥æ£€æµ‹ä¼ªé€ ã€‚äºæ˜¯æˆ‘å°è¯•å°†éšæœºæ€§ä» js è„šæœ¬ä¸­æå–åˆ° python ä»£ç é‡Œï¼Œä¿è¯ç›¸åŒä¼šè¯æ— è®ºåˆ·æ–°å¤šå°‘æ¬¡éƒ½æ˜¯ç”¨çš„åŒä¸€å¥—éšæœºæ•°ã€‚ç»“æœæœç„¶å°è¯äº†æˆ‘çš„çŒœæƒ³ã€‚

![](https://blog.mythsman.com/content/images/2021/06/image-25.png)![](https://blog.mythsman.com/content/images/2021/06/image-26.png)

è™½ç„¶çœ‹èµ·æ¥ä¸Šè¿°æ“ä½œèƒ½è§£å†³å·²çŸ¥çš„ Canvas æ£€æµ‹é—®é¢˜ï¼Œä½†åƒæ‰€æœ‰çš„æ”»å®ˆå¯¹æŠ—ä¸€æ ·ï¼Œåªè¦æ£€æµ‹æ–¹æ„¿æ„ï¼Œä»–ä»¬å¯ä»¥ååˆ†è½»æ¾çš„æƒ³å‡ºå¾ˆå¤šç§åŠæ³•æ£€æµ‹å‡ºæˆ‘ä»¬æ£€æµ‹å‡ºäº†ä»–ä»¬çš„æ£€æµ‹ä»£ç ğŸ˜…ï¼Œé—®é¢˜åªåœ¨äºä»–ä»¬æ˜¯å¦æœ‰é—²æƒ…åšè¿™ä»¶äº‹ã€ä»¥åŠè¿™ä»¶äº‹æƒ…æ˜¯å¦å¿…è¦ã€‚æ®æˆ‘æ‰€çŸ¥ç›®å‰è¢«æçš„æ¯”è¾ƒå¤šçš„ç½‘ç«™å¤§éƒ½ä¹Ÿéƒ½æ²¡æœ‰åšè¿™äº›æ£€æµ‹ï¼Œæ¯•ç«Ÿé™¤äº† Canvas æŒ‡çº¹ä¹‹å¤–ï¼Œä»–ä»¬ä¹Ÿæœ‰å¤ªå¤šçš„å·¥å…·å¯ä»¥ä½¿ç”¨ã€‚

[BrowserLeaks](https://browserleaks.com/)

[Coveryourtracks.eff.org](http://coveryourtracks.eff.org/)

[How Unique Is Your Web Browser?](https://coveryourtracks.eff.org/static/browser-uniqueness.pdf)

[Device_fingerprintï¼ˆWikipeidaï¼‰](https://en.wikipedia.org/wiki/Device_fingerprint)

[What is Fingerprinting?](https://trac.webkit.org/wiki/Fingerprinting)

[IT IS *NOT* POSSIBLE TO DETECT AND BLOCK CHROME HEADLESS](https://intoli.com/blog/not-possible-to-block-chrome-headless/)

[Do I have a canvas fingerprint spoofer installed in my browser](https://webbrowsertools.com/canvas-fingerprint/)