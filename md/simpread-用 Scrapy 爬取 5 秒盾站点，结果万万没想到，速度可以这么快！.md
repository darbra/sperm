> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/4OxCgqNirOPFrSvRY_7aRw)

  

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ TheWeiJunï¼Œæ¬¢è¿æ¥åˆ°æˆ‘çš„å…¬ä¼—å·ã€‚åœ¨æ–°çš„ä¸€å¹´é‡Œï¼ŒæœŸå¾…å¤§å®¶åœ¨æŠ€æœ¯å¾é€”ä¸Šä¸æ–­çªç ´ï¼Œè·å¾—æ›´å¤šçš„æˆå°±ã€‚ä»Šå¤©ï¼Œæˆ‘å°†ä¸å¤§å®¶åˆ†äº«ä¸€æ®µä»¤äººæŒ¯å¥‹çš„æ•…äº‹ï¼Œé€šè¿‡å¯¹ Scrapy çˆ¬è™«çš„ twisted æºç é«˜å¹¶å‘æ”¹é€ ï¼ŒæˆåŠŸå†²ç ´ 5 ç§’ç›¾ç«™ç‚¹çš„å±éšœã€‚è®©æˆ‘ä»¬ä¸€åŒè§£é”è¿™ä¸ªæŠ€æœ¯è°œå›¢ï¼Œæ¢ç´¢çˆ¬è™«ä¸–ç•Œçš„æ— é™å¯èƒ½ã€‚ç¥æ„¿å¤§å®¶åœ¨ 2024 å¹´è¿æ¥æ›´å¤šå¿«ä¹ï¼Œäº‹ä¸šè…¾é£ï¼

  

**ç‰¹åˆ«å£°æ˜ï¼š**æœ¬å…¬ä¼—å·æ–‡ç« åªä½œä¸ºå­¦æœ¯ç ”ç©¶ï¼Œä¸ä½œä¸ºå…¶ä»–ä¸æ³•ç”¨é€”ï¼›å¦‚æœ‰ä¾µæƒè¯·è”ç³»ä½œè€…åˆ é™¤ã€‚

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A6N3l9obtATicYg0vSreUhmEsiciaibJfHjG8MEHndnoJycRKpgeeK3LkxKu6qlz7oyC2Gelexa4W4Bfw/640?wx_fmt=gif)

ç«‹å³åŠ æ˜Ÿæ ‡

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6N3l9obtATicYg0vSreUhmEG7mwRfEUOichNPSVJkJl4IDcjeqvJyO5GGxL9CaYcRQqg13wjyXVzicQ/640?wx_fmt=png)

æ¯æœˆçœ‹å¥½æ–‡

Â ç›®å½•

  

ä¸€ã€å‰è¨€ä»‹ç»

äºŒã€å®æˆ˜åˆ†æ

ä¸‰ã€æºç é‡å†™

å››ã€æ€§èƒ½å¯¹æ¯”

äº”ã€å¾€æœŸæ¨è

  

![](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaawtmicxxynT0xDSjtEBPXy4ibgtWWibh69qBVIeuYlGgWPBV2dm8cosZFxicAgZShfCRQ3u9ZuFbuPicQ/640?wx_fmt=gif)

ä¸€ã€å‰è¨€ä»‹ç»

å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ TheWeiJunã€‚2024 å¹´å·²æ¥ä¸´ï¼Œæˆ‘æ€€æ£ç€å¯¹æŠ€æœ¯çš„çƒ­çˆ±ï¼Œè¿«ä¸åŠå¾…è¦ä¸å¤§å®¶åˆ†äº«ä¸€åœºå…³äº Scrapy çˆ¬è™«çš„æŠ€æœ¯å¥‡é‡ã€‚åœ¨è¿™ä¸ªæ•°å­—åŒ–é£é€Ÿå‘å±•çš„æ—¶ä»£ï¼Œæˆ‘ä»¬æ—¶åˆ»é¢ä¸´æ–°çš„æŠ€æœ¯æŒ‘æˆ˜ã€‚åœ¨ä»Šå¤©çš„æ•…äº‹ä¸­ï¼Œæˆ‘å°†å¼•é¢†å¤§å®¶ç©¿è¶Š Scrapy çš„æŠ€æœ¯è¿·é›¾ï¼Œé€šè¿‡ twisted æºç æ”¹é€ ï¼Œå®ç°é«˜å¹¶å‘çˆ¬å–ï¼ŒæˆåŠŸæ”»å…‹äº”ç§’ç›¾ç«™ç‚¹çš„æŠ€æœ¯éš¾å…³ã€‚

å¦‚æœä½ å¯¹æŠ€æœ¯æ¢é™©å……æ»¡å¥½å¥‡ï¼Œæ¸´æœ›çªç ´æŠ€æœ¯çš„è¾¹ç•Œï¼Œä¸å¦¨å…³æ³¨æˆ‘çš„å…¬ä¼—å·ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†ä¸€åŒæ¢ç´¢æœªçŸ¥é¢†åŸŸï¼Œå…±åŒå¯ç¨‹ï¼Œä¸º 2024 å¹´çš„æŠ€æœ¯å¾é€”æ­å¼€å´­æ–°çš„ç¯‡ç« ï¼è®°å¾—ç‚¹å…³æ³¨ï¼Œä¸€åŒè¸ä¸Šè¿™åœºæŠ€æœ¯å†’é™©ä¹‹æ—…å§ï¼

äºŒã€å®æˆ˜åˆ†æ  

1. é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ä¸ªä½¿ç”¨äº† CloudFlare çš„ç½‘ç«™ã€‚ç„¶åï¼Œåˆ›å»ºä¸€ä¸ª Scrapy é¡¹ç›®ï¼Œå¹¶ç¼–å†™ä»¥ä¸‹ Spider ä»£ç ï¼š

```
# -*- coding: utf-8 -*-
from urllib.parse import urlencode
import scrapy
class CloudflareSpider(scrapy.Spider):
    name = 'cloudflare_spider'
    def __init__(self):
        super().__init__()
        self.headers = {
            'authority': 'xxxxx',
            'accept': 'application/json, text/plain, */*',
            'accept-language': 'zh-CN,zh;q=0.9,en;q=0.8',
            'cache-control': 'no-cache',
            'pragma': 'no-cache',
            'referer': 'https://xxxxx/feed',
            'sec-ch-ua': '"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',
            'sec-ch-ua-mobile': '?0',
            'sec-ch-ua-platform': '"macOS"',
            'sec-fetch-dest': 'empty',
            'sec-fetch-mode': 'cors',
            'sec-fetch-site': 'same-origin',
            'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
        }
        self.url = 'https://xxxx/xxx/xxx/'
    def start_requests(self):
        for page in range(1, 100):
            params = {
                'page': page,
                'posts_to_load': '5',
                'sort': 'top',
            }
            proxies = {
                "http": "http://127.0.0.1:59292",
                "https": "http://127.0.0.1:59292",
            }
            full_url = self.url + '?' + urlencode(params)
            yield scrapy.Request(
                url=full_url,
                headers=self.headers,
                callback=self.parse,
                dont_filter=True,
                meta={"proxies": proxies}
            )
    def parse(self, response, **kwargs):
        print(response.text)

```

2. ä»£ç ç¼–å†™å®Œæˆåï¼Œè®©æˆ‘ä»¬ä¸€èµ·æ¥æŸ¥çœ‹æ•´ä¸ª Scrapy é¡¹ç›®çš„ç»“æ„ã€‚ä»¥ä¸‹æ˜¯é¡¹ç›®ç›®å½•ç»“æ„çš„æˆªå›¾ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RxRZW3pBbCHAjW9YbsuaAWiaCGavHYsicibETHKZLqlpsGmw37blfN0nAA/640?wx_fmt=png&from=appmsg)

3. æ¥ç€ï¼Œæˆ‘ä»¬ç¼–å†™ run_spider.py æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­æ³¨å†Œæˆ‘ä»¬æƒ³è¦å¯åŠ¨çš„ Spiderï¼ˆä½¿ç”¨ spider_name å˜é‡ï¼‰ä»¥ä¸‹æ˜¯ä»£ç ç¤ºä¾‹ï¼š

```
from scrapy.crawler import CrawlerProcess
from scrapy.utils.project import get_project_settings
def run_spider():
    process = CrawlerProcess(get_project_settings())
    process.crawl('cloudflare_spider')
    process.start()
if __name__ == "__main__":
    run_spider()

```

4. é€šè¿‡ run_spider.py æ¨¡å—è¿è¡Œçˆ¬è™«ï¼Œå¯ä»¥çœ‹åˆ° 403 çŠ¶æ€ç é”™è¯¯è¯·æ±‚ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RXPxjKrf1HXQficAgBuRHAImq4fcqmlIDGBHac7nPeRZ76cKdJiamSibaw/640?wx_fmt=png&from=appmsg)

5. æ­¤æ—¶ï¼ŒScrapy çš„ parse è§£æå‡½æ•°å¯èƒ½æ— æ³•è·å–åˆ°å¤±è´¥çš„ responseï¼Œå› ä¸º Scrapy é»˜è®¤åªå¤„ç†çŠ¶æ€ç åœ¨ 200 èŒƒå›´å†…çš„è¯·æ±‚ã€‚ä¸ºäº†èƒ½å¤ŸæŸ¥é˜…å¤±è´¥çš„è¯·æ±‚ç»“æœï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®å…è®¸é€šè¿‡çš„çŠ¶æ€ç å‚æ•°ã€‚ä»¥ä¸‹æ˜¯ç›¸åº”çš„ä»£ç è®¾ç½®ï¼š

```
HTTPERROR_ALLOWED_CODES = [403]

```

  
6. æ¥ä¸‹æ¥è®²è§£ä¸€ä¸‹ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾ç½®? æˆ‘ä»¬æ‰“å¼€ scrapy æºç ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š  

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RibMG12k9e0RuIVkiagbeGsBrGTJy42ryztLl8f6foqoN6j8QdMowSAlA/640?wx_fmt=png&from=appmsg)

7. åœ¨ spidermiddlewares ä¸­é—´ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ° HttpErrorMiddleware æ¨¡å—ã€‚å½“ Scrapy å¯åŠ¨æ—¶ï¼Œå„ä¸ªæ¨¡å—ä¼šè¢«æ³¨å†Œåˆ° spidermiddlewares ä¸­é—´ä»¶ã€‚ç°åœ¨è®©æˆ‘ä»¬æ·±å…¥äº†è§£å®ƒæ˜¯å¦‚ä½•è¿è¡Œçš„ï¼Œä»¥ä¸‹æ˜¯ç›¸å…³ä»£ç æˆªå›¾ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RreyJhLg5oWGJc9Fibz7vicNkeaIR7D46SXosUere6uIQeUcUSoyLkqVw/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**è§‚å¯Ÿä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ³¨æ„åˆ° Scrapy çš„ä½œè€…é»˜è®¤ä¼šè¿‡æ»¤æ‰çŠ¶æ€ç åœ¨ 200 ä»¥å†…çš„è¯·æ±‚ï¼Œå› ä¸ºåœ¨ä½œè€…çœ‹æ¥ï¼Œä»¥ 200 å¼€å¤´çš„è¯·æ±‚éƒ½æ˜¯æˆåŠŸçš„ã€‚ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦è‡ªå®šä¹‰å…è®¸é€šè¿‡çš„è¯·æ±‚çŠ¶æ€ç ï¼Œå°±éœ€è¦è®¾ç½® HTTPERROR_ALLOWED_CODESã€‚

8. æˆ‘ä»¬çŸ¥é“ spider ä¸­é—´ä»¶åŸç†å¹¶è®¾ç½® 403 çŠ¶æ€ç åï¼Œé‡æ–°è¿è¡Œä»£ç ï¼Œæˆªå›¾å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RZKh0JyZISSa0GM5mKoItDzEgGibs4bpNfdBkIvxOfzVBdFeLsb0QJ4Q/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**è¿™å¼ é¡µé¢æˆªå›¾å¯¹äºé‚£äº›å·²ç»æ¥è§¦è¿‡ 5 ç§’ç›¾çš„ Spider å¼€å‘è€…æ¥è¯´åº”è¯¥ä¸é™Œç”Ÿã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ tls_client åŒ…æ¥ç»•è¿‡ 5 ç§’ç›¾æœºåˆ¶ã€‚  

9. æ­¤å¤–ï¼Œå¤§å®¶åº”è¯¥éƒ½ä½¿ç”¨è¿‡ download middlewares ä¸­é—´ä»¶ã€‚ä¸‹é¢æˆ‘ä»¬å°†åœ¨ä¸‹è½½å™¨ä¸­é—´ä»¶ä¸­å¤„ç† 5 ç§’ç›¾è¯·æ±‚ï¼Œç›¸å…³ä»£ç å¦‚ä¸‹ï¼š  

```
from scrapy.http import HtmlResponse
from tls_client import Session
class DownloaderMiddleware(object):
    def __init__(self):
        self.session: Session = Session(
            client_identifier="chrome_104"
        )
    def process_request(self, request, spider):
        proxies = request.meta.get("proxies") or None
        headers = request.headers.to_unicode_dict()
        if request.method == "GET":
            response = self.session.get(
                url=request.url,
                headers=headers,
                proxy=proxies,
                timeout_seconds=60,
            )
        else:
            response = self.session.post(
                url=request.url,
                headers=headers,
                proxy=proxies,
                timeout_seconds=60,
            )
        return HtmlResponse(
            url=request.url,
            status=response.status_code,
            body=response.content,
            encoding="utf-8",
            request=request,
        )

```

10. å°†ä¸Šé¢çš„æ¨¡å—æ³¨å†Œåˆ°ä¸‹è½½å™¨ä¸­é—´ä»¶åï¼Œæˆ‘ä»¬å¯åŠ¨çˆ¬è™«è§‚å¯Ÿè¯·æ±‚ç»“æœï¼Œæˆªå›¾å¦‚ä¸‹æ‰€ç¤ºï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2Rbp68K5Vd9YzjHWXkdygdMDAn7KL0n2PZwI3yvhNklHsDqx2IYpEYKA/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**å°½ç®¡ 5 ç§’ç›¾å·²ç»èƒ½å¤ŸæˆåŠŸè§£å†³å¹¶è¿”å›ç»“æœï¼Œæˆ‘ä»¬å´å‘ç° Scrapy å¹¶æ²¡æœ‰å……åˆ†å‘æŒ¥ Twisted çš„å¼‚æ­¥æœºåˆ¶ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨ä¸‹è½½å™¨ä¸­é—´ä»¶ä¸­å¤„ç†è¯·æ±‚æ—¶ï¼Œå®é™…ä¸Šæ˜¯åœ¨åŒæ­¥çš„ç¯å¢ƒä¸‹è¿è¡Œçš„ã€‚å¦‚æœæˆ‘ä»¬å¸Œæœ› Scrapy èƒ½å¤Ÿå®ç°é«˜å¹¶å‘ï¼Œå°±å¿…é¡»ä¿®æ”¹ Twisted çš„è¯·æ±‚æ¨¡å—ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ Twisted è¯·æ±‚ç»„ä»¶æˆ–è€…å…¼å®¹ tls_client æ¨¡å—æ¥å®ç°é«˜å¹¶å‘ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©åè€…çš„æ–¹å¼ï¼Œä»¥è¾¾åˆ° Scrapy é«˜å¹¶å‘çš„ç›®æ ‡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿›å…¥æºç é‡å†™çš„ç¯èŠ‚ã€‚

ä¸‰ã€æºç é‡å†™

1. é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ Scrapy çš„è¿è¡Œæœºåˆ¶ï¼Œç„¶åæ‰¾åˆ°ç›¸åº”çš„æ¨¡å—ï¼Œå¹¶æŸ¥çœ‹ Scrapy æºç çš„å®ç°ã€‚ä»¥ä¸‹æ˜¯ç›¸åº”çš„æˆªå›¾ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2Ric8kNRQsPDU696AP2xSFplMsa8oqxwEqSzq7PhyB4qZQgABcb8KqGjg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RyTS26yphUIraLSopIdRlpxN2GmKicOcC0pM5tk5kwS5vux1nEhicic89g/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**åœ¨ Scrapy å¯åŠ¨æ—¶ï¼Œå®ƒé€šè¿‡ downloader_handlers ä¸­çš„ download_request æ–¹æ³•åŠ è½½ Twisted æ¨¡å—ï¼Œä»è€Œè¿›è¡Œè¯·æ±‚çš„å¼‚æ­¥å¤„ç†ã€‚ä¸€æ—¦æˆ‘ä»¬è·å¾—äº†çµæ„Ÿï¼Œå°±å¯ä»¥å¼€å§‹ç»§æ‰¿å¹¶é‡å†™ Scrapy çš„æºç ã€‚

2. æˆ‘ä»¬ç»§æ‰¿é‡å†™ downloader hanlders ä¸­çš„æ¨¡å—ï¼Œé‡å†™åæºç å¦‚ä¸‹ï¼š

```
"""Download handlers for http and https schemes"""
import logging
from time import time
from urllib.parse import urldefrag
from tls_client import Session
from twisted.internet import threads
from twisted.internet.error import TimeoutError
from scrapy.http import HtmlResponse
from scrapy.core.downloader.handlers.http11 import HTTP11DownloadHandler
logger = logging.getLogger(__name__)
class CloudFlareDownloadHandler(HTTP11DownloadHandler):
    def __init__(self, settings, crawler=None):
        super().__init__(settings, crawler)
        self.session: Session = Session(
            client_identifier="chrome_104"
        )
    @classmethod
    def from_crawler(cls, crawler):
        return cls(crawler.settings, crawler)
    def download_request(self, request, spider):
        from twisted.internet import reactor
        timeout = request.meta.get("download_timeout") or 10
        # request details
        url = urldefrag(request.url)[0]
        start_time = time()
        # Embedding the provided code asynchronously
        d = threads.deferToThread(self._async_download, request)
        # set download latency
        d.addCallback(self._cb_latency, request, start_time)
        # check download timeout
        self._timeout_cl = reactor.callLater(timeout, d.cancel)
        d.addBoth(self._cb_timeout, url, timeout)
        return d
    def _async_download(self, request):
        timeout = int(request.meta.get("download_timeout"))
        proxies = request.meta.get("proxies") or None
        headers = request.headers.to_unicode_dict()
        if request.method == "GET":
            response = self.session.get(
                url=request.url,
                headers=headers,
                proxy=proxies,
                timeout_seconds=timeout,
            )
        else:
            response = self.session.post(
                url=request.url,
                headers=headers,
                proxy=proxies,
                timeout_seconds=timeout,
            )
        return HtmlResponse(
            url=request.url,
            status=response.status_code,
            body=response.content,
            encoding="utf-8",
            request=request,
        )
    def _cb_timeout(self, result, url, timeout):
        if self._timeout_cl.active():
            self._timeout_cl.cancel()
            return result
        raise TimeoutError(f"Getting {url} took longer than {timeout} seconds.")
    def _cb_latency(self, result, request, start_time):
        request.meta["download_latency"] = time() - start_time
        return result

```

**æ€»ç»“ï¼š**æºç é‡å†™å·¥ä½œå·²ç»åœ†æ»¡å®Œæˆï¼Œæ­¤æ—¶æˆ‘ä»¬è¿«ä¸åŠå¾…åœ°æœŸå¾…ç€ Scrapy åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹çš„è¡¨ç°ã€‚æ€€æ£è¿™ä¸ªç–‘é—®ï¼Œè®©æˆ‘ä»¬è¿…é€Ÿè¿›å…¥æ€§èƒ½å¯¹æ¯”ç¯èŠ‚ã€‚åœ¨è¿›è¡Œæœ€åçš„æ­¥éª¤æ—¶ï¼Œè¯·ç¡®ä¿å°†é‡å†™çš„ä»£ç æ³¨å†Œåˆ° DOWNLOAD_HANDLERS ä¸­é—´ä»¶æ¨¡å—ã€‚

å››ã€æ€§èƒ½å¯¹æ¯”

ä¸ºäº†è¿›è¡Œæ€§èƒ½å¯¹æ¯”ï¼Œæˆ‘ä»¬æŒ‰ç…§ä»¥ä¸‹è§„åˆ™è¿›è¡Œæµ‹è¯•ï¼š

*   æ‰§è¡Œ 100 ä¸ªè¯·æ±‚çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸‹è½½å™¨ä¸­é—´ä»¶æ–¹æ¡ˆã€‚
    
*   æ‰§è¡Œ 100 ä¸ªè¯·æ±‚çš„æƒ…å†µä¸‹ä½¿ç”¨ Twisted æºç é‡å†™æ–¹æ¡ˆã€‚
    
*   æ‰§è¡Œ 500 ä¸ªè¯·æ±‚çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸‹è½½å™¨ä¸­é—´ä»¶æ–¹æ¡ˆã€‚
    
*   æ‰§è¡Œ 500 ä¸ªè¯·æ±‚çš„æƒ…å†µä¸‹ä½¿ç”¨ Twisted æºç é‡å†™æ–¹æ¡ˆã€‚
    

1. é˜…è¯»å®Œå¯¹æ¯”æµç¨‹åï¼Œæˆ‘ä»¬å…ˆæ‰§è¡Œä¸‹è½½å™¨ä¸­é—´ä»¶æ–¹æ¡ˆï¼Œscrapy è¾“å‡ºæ—¥å¿—å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RfmH6FFTHRt6niaSzFXsdc2YQcr8bUtTic2vOW9DEPqyh1Naic2d2oiab4Q/640?wx_fmt=png&from=appmsg)

2. æ¥ç€ï¼Œåœ¨ç›¸åŒçš„ç¯å¢ƒä¸­ï¼Œæ‰§è¡Œæºç é‡å†™æ–¹æ¡ˆï¼ŒScrapy è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RJZYTkqqaVoqw9wwDcm3hvMpTiac2n0dvR39fFZLmfGBqiaXxv7dhsLGw/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**é€šè¿‡å¯¹æ¯”ä¸¤å¼ æˆªå›¾çš„ elapsed_time_seconds å­—æ®µï¼Œæ˜æ˜¾å¯ä»¥è§‚å¯Ÿåˆ° Scrapy Twisted æºç é‡å†™æ–¹æ¡ˆåœ¨æ‰§è¡Œ 100 æ¬¡è¯·æ±‚æ—¶ï¼Œçˆ¬å–é€Ÿåº¦æå‡äº† 6 å€ã€‚ä¸ºäº†ç¡®ä¿æ€§èƒ½å¯¹æ¯”çš„æƒå¨æ€§ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ†åˆ«æ‰§è¡Œ 500 æ¬¡è¯·æ±‚ã€‚

3. åœ¨æ‰§è¡Œ 500 æ¬¡è¯·æ±‚æ—¶ï¼Œä»ç„¶é¦–å…ˆé‡‡ç”¨ä¸‹è½½å™¨ä¸­é—´ä»¶æ–¹æ¡ˆï¼ŒScrapy è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2R3WFrNYbich0SGLr7PsS1U999qTd3Y3PRNAPtlVLpI7rwib9RdY0nk90w/640?wx_fmt=png&from=appmsg)

4. ç´§æ¥ç€ï¼Œæˆ‘ä»¬æ‰§è¡Œ 500 æ¬¡è¯·æ±‚ï¼Œé‡‡ç”¨ twisted æºç é‡å†™æ–¹æ¡ˆï¼ŒScrapy è¾“å‡ºçš„æ—¥å¿—å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2RnxWdqLwKh15Mnap7oouqV0mRddTsF9AUTh5ktNKp1U1ibEwGiaghgypQ/640?wx_fmt=png&from=appmsg)

**æ€»ç»“ï¼š**é€šè¿‡æ¯”è¾ƒ 500 æ¬¡è¯·æ±‚çš„ä¸¤å¼ æˆªå›¾ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿåˆ°ï¼Œåœ¨ elapsed_time_seconds æ–¹é¢ï¼ŒScrapy Twisted æºç é‡å†™æ–¹æ¡ˆæ˜æ˜¾ä¼˜äºä¸‹è½½å™¨ä¸­é—´ä»¶æ–¹æ¡ˆã€‚åœ¨åŒæ—¶æ‰§è¡Œ 500 æ¬¡è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œçˆ¬å–é€Ÿåº¦æå‡çº¦ä¸º 9 å€ã€‚åŸºäºè¿™ä¸ªç»“æœï¼Œæˆ‘ç›¸ä¿¡åœ¨è¯·æ±‚é‡è¶³å¤Ÿå¤§çš„åœºæ™¯ä¸‹ï¼Œé‡‡ç”¨ Scrapy Twisted æºç é‡å†™æ–¹æ¡ˆèƒ½å¤Ÿæ˜¾è‘—æå‡çˆ¬å–æ•ˆç‡ã€‚

äº”ã€å¾€æœŸæ¨è

æœ¬ç¯‡æ–‡ç« åˆ†äº«åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œæ¬¢è¿å¤§å®¶å…³æ³¨ä¸‹æœŸæ–‡ç« ï¼Œæˆ‘ä»¬ä¸è§ä¸æ•£![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2R5eNiaJWETUDCKtBHcZL5T8kbPWd3cuXiaHPeGdxTAjWBBw9p1nEQslcg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2R5eNiaJWETUDCKtBHcZL5T8kbPWd3cuXiaHPeGdxTAjWBBw9p1nEQslcg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2R5eNiaJWETUDCKtBHcZL5T8kbPWd3cuXiaHPeGdxTAjWBBw9p1nEQslcg/640?wx_fmt=png&from=appmsg)  
æ–‡ç« ç»“å°¾ç»™å¤§å®¶å‡†å¤‡äº†å½©è›‹ï¼Œå¯ä»¥é¢†å–å¾®ä¿¡çº¢åŒ…ï¼Œæå‰ç¥å¤§å®¶æ–°æ˜¥å¿«ä¹![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2Rx7woGMkyKmrnttPphTEB2IqMicM5aYw1Wa5NEIpYZ3C9bwsFWzAePqg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2Rx7woGMkyKmrnttPphTEB2IqMicM5aYw1Wa5NEIpYZ3C9bwsFWzAePqg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A6yelSOV4CAGF5TMxHUxr2Rx7woGMkyKmrnttPphTEB2IqMicM5aYw1Wa5NEIpYZ3C9bwsFWzAePqg/640?wx_fmt=png&from=appmsg)  
**ç²‰ä¸ç¦åˆ©ï¼š**å…¬ä¼—å·åå°å›å¤ **888** å³å¯è·å– github å®Œæ•´å¼€æºä»“åº“ã€‚

å¾€æœŸæ¨è

[

æŸäº‘æ»‘å—éªŒè¯ç åˆ«ä¹±æ…ï¼ä¸€ä¸å°å¿ƒå°±åçˆ¬äº†ã€‚



](https://mp.weixin.qq.com/s?__biz=Mzg5ODA3OTM1NA==&mid=2247491688&idx=1&sn=3c7c98709ad36032f8b8ade92f7881c2&chksm=c06aaf7df71d266b77999518c53af8dbb04b44d431d9aa70852257b95cd973e402475b944b08&scene=21#wechat_redirect)

[

æŸç¾æ»‘å—éªŒè¯ç åˆ«ä¹±æ…ï¼ä¸€ä¸å°å¿ƒå°±åçˆ¬äº†ã€‚



](https://mp.weixin.qq.com/s?__biz=Mzg5ODA3OTM1NA==&mid=2247491526&idx=1&sn=55c3085d1052c169f29d42f384e8d16e&chksm=c06950d3f71ed9c5986b4653c11db2662fdf3781666899be6abc114703acbf8d734ee5eae3cc&scene=21#wechat_redirect)

[

æ·±å…¥æ¢ç´¢ Go è¯­è¨€ net/http åŒ…æºç ï¼šä»çˆ¬è™«çš„è§†è§’è§£æ HTTP å®¢æˆ·ç«¯



](https://mp.weixin.qq.com/s?__biz=Mzg5ODA3OTM1NA==&mid=2247490768&idx=1&sn=c02b065b8e4a96904833d3b80b62835c&chksm=c06953c5f71edad384aedb70b911b2d43f940c74ec821a6c86c0c5da3cdca785130ed7815714&scene=21#wechat_redirect)

[

æ¢ç§˜è¿·é›¾èƒŒåï¼šé€†å‘çŸ­è§†é¢‘å¼¹å¹•ç³»ç»Ÿçš„å¥‡å¦™ä¹‹æ—…



](https://mp.weixin.qq.com/s?__biz=Mzg5ODA3OTM1NA==&mid=2247490764&idx=1&sn=3ffe639940160433ffa3e5195a127997&chksm=c06953d9f71edacf0d8f168f5886c7c4e4690e5209677e10bebdc214043f24ffe540544daa1b&scene=21#wechat_redirect)

[

DX æ»‘å—éªŒè¯ç åˆ«ä¹±æ…ï¼ä¸€ä¸å°å¿ƒå°±åçˆ¬äº†ã€‚



](https://mp.weixin.qq.com/s?__biz=Mzg5ODA3OTM1NA==&mid=2247489011&idx=1&sn=3244b1d79fdfe4c7fb6f858d0576bc8b&chksm=c0695ae6f71ed3f0db05a936a3692d2013c85a55a058fef4a4c500e2705eae739f18f13e4c46&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A47tBINwSQml9LBbhoHC1zXx7gzfJ3gvfXgbCervO9niaprHP6aiae9Dl7icz7SCsp9qDfkchax1Exsw/640?wx_fmt=gif)

é¾™å¹´å¤§å‰

  

**  
å¦‚æœæƒ³è¦è·å¾—æ›´å¤šç²¾å½©å†…å®¹å¯ä»¥å…³æ³¨æˆ‘æœ‹å‹:**

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A7revypRO1iacSSjh6m3iaeZ7k7QiaRDzFktiaSbkClw0pXa6NV1Q9ge9a6D5nxGOojicqVQUQqQK0NOHg/640?wx_fmt=png)

_**END**_

![](https://mmbiz.qpic.cn/mmbiz_png/m5qEELWt8A7revypRO1iacSSjh6m3iaeZ7zpB5TQPCHMeJVyX5BicWRibtHzfCIJvrJRAiaLC9akyJxXrfKVMnUS6rw/640?wx_fmt=png)

  

  

  

  

  

  

ä½œè€…ç®€ä»‹  

  

  

æˆ‘æ˜¯ **TheWeiJun**ï¼Œæœ‰ç€æ‰§ç€çš„è¿½æ±‚ï¼Œä¿¡å¥‰ç»ˆèº«æˆé•¿ï¼Œä¸å®šä¹‰è‡ªå·±ï¼Œçƒ­çˆ±æŠ€æœ¯ä½†ä¸æ‹˜æ³¥äºæŠ€æœ¯ï¼Œçˆ±å¥½åˆ†äº«ï¼Œå–œæ¬¢è¯»ä¹¦å’Œä¹äºç»“äº¤æœ‹å‹ï¼Œæ¬¢è¿æ‰«æˆ‘å¾®ä¿¡ä¸æˆ‘äº¤æœ‹å‹ğŸ’•

åˆ†äº«æ—¥å¸¸å­¦ä¹ ä¸­å…³äºçˆ¬è™«åŠé€†å‘åˆ†æçš„ä¸€äº›æ€è·¯ï¼Œæ–‡ä¸­è‹¥æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæ¬¢è¿å¤§å®¶å¤šå¤šäº¤æµæŒ‡æ­£ğŸ’•

  

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/m5qEELWt8A4QPIsiaD2F0kQdBViby9s1UsyIkT8kzGfPRzeVicUqrcPJgjI1JcYrmukxRTbYR2VxH5zrx09ct5TEg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A7lKEcIibT9GVduic8eSDCiaFLwXGFXXOX978IvJSokfVzoN9L2EUB8bUAC0QqT1WJmckZfBfZJl3FFA/640?wx_fmt=gif)

**ç‚¹åˆ†äº«**

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A7lKEcIibT9GVduic8eSDCiaFLAWgUzHv0vx1STQhKykWTpicN12F4UdUeNXS1WsXYicqeBzmEUQbB3dAg/640?wx_fmt=gif)

**ç‚¹æ”¶è—**

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A7lKEcIibT9GVduic8eSDCiaFLJzbzyLgP8z7NIwqluryicesaw2PBoEPNvQ8K0jpyqn7AlA3vHGq1n3Q/640?wx_fmt=gif)

**ç‚¹ç‚¹èµ**

![](https://mmbiz.qpic.cn/mmbiz_gif/m5qEELWt8A7lKEcIibT9GVduic8eSDCiaFLXdRibvzbwpGJb8wcTtFaUYTx1WXpUiaaD9TYy6Rk7jYhSwAL7c7BsSbA/640?wx_fmt=gif)

**ç‚¹åœ¨çœ‹**