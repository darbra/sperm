> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s/E5lbFrVyBR0qumJIiW_3Tg)

> å…è´£å£°æ˜ï¼šæ–‡ç« ä¸­æ‰€æœ‰å†…å®¹ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼ŒæŠ“åŒ…å†…å®¹ã€æ•æ„Ÿç½‘å€ã€æ•°æ®æ¥å£å‡å·²åšè„±æ•å¤„ç†ï¼Œä¸¥ç¦ç”¨äºå•†ä¸šå’Œéæ³•ç”¨é€”ï¼Œå¦åˆ™ç”±æ­¤äº§ç”Ÿçš„ä¸€åˆ‡åæœä¸ä½œè€…æ— å…³ã€‚è‹¥æœ‰ä¾µæƒï¼Œè¯·åœ¨å…¬ä¼—å·ã€CYRUS STUDIOã€‘è”ç³»ä½œè€…

æœç´¢æ¥å£æŠ“åŒ…åˆ†æ
========

æŠ“åŒ…æ•°æ®å¦‚ä¸‹ï¼š

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXcA5icGOCwX3LWUSazOxqFSDnHgbaeicv9aVJHgbhyOPUGLfV0BhwcG9Nw/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image1.png

  
Request å’Œ Response çš„ Body è¢«åŠ å¯†æ— æ³•ç›´æ¥æŸ¥çœ‹ã€‚

è¯·æ±‚åœ°å€ï¼š

```
https://***************************/aweme/v2/search/general/single/?klink_egdi=********************************************************&iid=****************&device_id=****************&ac=****&channel=*******************&aid=****&app_name=*****&version_code=******&version_name=******&device_platform=*******&os=*******&ssmix=*&device_type=*****&device_brand=******&language=**&os_api=**&os_version=**&manifest_version_code=******&resolution=*********&dpi=***&update_version_code=********&_rticket=*************&package=************************&first_launch_timestamp=**********&last_deeplink_update_version_code=*&cpu_support64=****&host_abi=*********&is_guest_mode=*&app_type=******&minor_status=*&appTheme=*****&is_preinstall=*&need_personal_recommend=*&is_android_pad=*&is_android_fold=*&ts=**********&cdid=************************************

```

è¯·æ±‚å¤´ï¼š

```
:method: POST
:authority: ***************************
:scheme: https
:path: /aweme/v2/search/general/single/?klink_egdi=********************************************************&iid=****************&device_id=****************&ac=****&channel=*******************&aid=****&app_name=*****&version_code=******&version_name=******&device_platform=*******&os=*******&ssmix=*&device_type=*****&device_brand=******&language=**&os_api=**&os_version=**&manifest_version_code=******&resolution=*********&dpi=***&update_version_code=********&_rticket=*************&package=************************&first_launch_timestamp=**********&last_deeplink_update_version_code=*&cpu_support64=****&host_abi=*********&is_guest_mode=*&app_type=******&minor_status=*&appTheme=*****&is_preinstall=*&need_personal_recommend=*&is_android_pad=*&is_android_fold=*&ts=**********&cdid=************************************
content-length: ****
cookie: ****************************************************
cookie: ************************************************************
cookie: ******************
cookie: ********************
cookie: ************************************************************************************************************************************************************************
cookie: ***************************
cookie: ************************************************
x-tt-dt: ******************************************************************************************************************************************************
activity_now_client: *************
compressed-bcm-chain: ******************************************************************************************************************************************************************************************************************************************************************************
x-ss-req-ticket: *************
sdk-version: *
passport-sdk-version: *****
x-vc-bdturing-sdk-version: ********
content-type: ************************************************
x-ss-stub: ******************************
x-bd-content-encoding: ****
x-tt-store-region: *****
x-tt-store-region-src: ***
x-tt-request-tag: ********
x-ss-dp: ****
x-tt-trace-id: *******************************************************
user-agent: ********************************************************************************************************************************************************************
ttzip-version: **********
ttzip-tlb: *
accept-encoding: ************************
x-argus: ********
x-gorgon: ****************************************************
x-helios: ************************************************
x-khronos: **********
x-ladon: ********
x-medusa: ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************
x-soter: ************************************************************************************************************************

(ï¿½/ï¿½`ï¿½=ï¿½{

```

curl è¯·æ±‚å¦‚ä¸‹ï¼š

```
curl -H "Host: ***************************" -H "Cookie: *********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************" -H "x-tt-dt: ******************************************************************************************************************************************************" -H "activity_now_client: *************" -H "compressed-bcm-chain: ******************************************************************************************************************************************************************************************************************************************************************************" -H "x-ss-req-ticket: *************" -H "sdk-version: *" -H "passport-sdk-version: *****" -H "x-vc-bdturing-sdk-version: ********" -H "content-type: ************************************************" -H "x-ss-stub: ******************************" -H "x-bd-content-encoding: ****" -H "x-tt-store-region: *****" -H "x-tt-store-region-src: ***" -H "x-tt-request-tag: ********" -H "x-ss-dp: ****" -H "x-tt-trace-id: *******************************************************" -H "user-agent: ********************************************************************************************************************************************************************" -H "ttzip-version: **********" -H "ttzip-tlb: *" -H "x-argus: ********" -H "x-gorgon: ****************************************************" -H "x-helios: ************************************************" -H "x-khronos: **********" -H "x-ladon: ********" -H "x-medusa: ************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************" -H "x-soter: ************************************************************************************************************************" --data-binary "(ï¿½/ï¿½`ï¿½=ï¿½{

```

Responseï¼š

```
:status: ***
server: Tengine
content-type: application/json; charset=utf-8
date: *****************************
vary: Accept-Encoding
x-tt-logid: **********************************
status_code: 0
bd-tt-error-code: 0
tt_stable: 1
strict-transport-security: ***********************************
tt-idc-switch: ********************
server-timing: ***************
x-tt-trace-host: ************************************************************************************************************************************************************************************************
x-tt-trace-tag: *****************************
x-tt-trace-id: *******************************************************
content-encoding: ttzip
ttzip-version: **********
server-timing: **********************************************
via: **********************
timing-allow-origin: *
eagleid: **************************

(ï¿½/ï¿½ï¿½bï¿½ i/

```

ç›¸å…³æ–‡ç« ï¼š

*   â€¢Â å¦‚ä½•å®ç° Android App çš„æŠ“åŒ…é˜²æŠ¤ï¼Ÿåˆè¯¥å¦‚ä½•ç»•è¿‡ï¼Ÿä¸€æ–‡çœ‹æ‡‚æ”»é˜²åšå¼ˆ [1]
    
*   â€¢Â å®‰å“æŠ“åŒ…å®æˆ˜ï¼šä½¿ç”¨ Charles æŠ“å– App æ•°æ®å…¨æµç¨‹è¯¦è§£ [2]
    

Dex è„±å£³ä¸ TTNet æºç åˆ†æ
==================

ä½¿ç”¨Â frida_dex_dump[3]Â è„±å£³ dex ï¼Œå†ç”¨Â dex2jar[4]Â æŠŠ dex æ‰¹é‡è½¬æ¢æˆ jarã€‚

TTNet æ˜¯ **** åŸºäº Retrofit æ·±åº¦æ”¹é€ çš„é—­æºç½‘ç»œæ¡†æ¶ï¼Œé›†æˆè¯·æ±‚åŠ å¯†ã€æ‹¦æˆªå™¨é“¾è·¯ã€æ€§èƒ½åŸ‹ç‚¹å’Œå®¢æˆ·ç«¯å¯†é’¥æœºåˆ¶ï¼Œå¹¿æ³›ç”¨äºå…¶å†…éƒ¨ App çš„ç½‘ç»œé€šä¿¡ã€‚

ä½¿ç”¨Â find_in_jars.py[5]Â æŸ¥æ‰¾ ttnet åŒ…ä¸‹çš„ç±»ï¼š

```
(anti-app) PS D:\Python\anti-app\dex2jar> python find_in_jars.py "D:\Python\anti-app\app\douyin\dump_dex\jar" "com.*********.ttnet"
[+] Searching for class prefix: com/*********/ttnet
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes2.jar â†’ com/*********/ttnet/TTNetInit$ENV.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes23.jar â†’ com/*********/ttnet/debug/DebugSetting.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/http/HttpRequestInfo.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/http/RequestContext.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/HttpClient.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/ITTNetDepend.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/TTALog.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/TTMultiNetwork.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/TTNetInit.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/clientkey/ClientKeyManager.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/config/AppConfig.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/config/TTHttpCallThrottleControl$DelayMode.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/config/TTHttpCallThrottleControl.class Â  Â  Â  Â 
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/cronet/AbsCronetDependAdapter.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/diagnosis/TTNetDiagnosisService.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/priority/TTHttpCallPriorityControl$ModeType.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/priority/TTHttpCallPriorityControl.class Â  Â  Â 
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/retrofit/SsInterceptor.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/retrofit/SsRetrofitClient.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/throttle/TTNetThrottle.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/tnc/TNCManager$TNCUpdateSource.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/tnc/TNCManager.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/utils/RetrofitUtils$CompressType.class Â  Â  Â  Â 
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes37.jar â†’ com/*********/ttnet/utils/RetrofitUtils.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes47.jar â†’ com/*********/ttnet/diagnosis/IDiagnosisRequest.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes47.jar â†’ com/*********/ttnet/diagnosis/IDiagnosisCallback.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes47.jar â†’ com/*********/ttnet/diagnosis/TTGameDiagnosisService.class Â  Â  Â  Â 
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes49.jar â†’ com/*********/ttnet/http/IRequestHolder.class
[âœ“] Found in: D:\Python\anti-app\app\douyin\dump_dex\jar\base.apk_classes7.jar â†’ com/*********/ttnet/INetworkApi.class
[+] Total 29 match(es) found.

```

æ‰¾åˆ° TTNet çš„æ‹¦æˆªå™¨ï¼šcom/*********/ttnet/retrofit/SsInterceptor

jar æ–‡ä»¶æ£€ç´¢å·¥å…·ï¼šæ‰“é€ è‡ªå·±çš„ Jar æ–‡ä»¶åˆ†æå·¥å…·ï¼šç±»ååŒ¹é… + äºŒè¿›åˆ¶æœç´¢ + æ—¥å¿—è¾“å‡ºå…¨æå®š [6]

SsInterceptor æ–¹æ³•è°ƒç”¨åˆ†æ
--------------------

ä½¿ç”¨ frida hook ä¸€ä¸‹ SsInterceptor ä¸­çš„æ‰€æœ‰æ–¹æ³•

```
/**
Â * Hook æŒ‡å®šç±»çš„æ‰€æœ‰æ–¹æ³•ï¼ˆæ¯ä¸ªæ–¹æ³•æ‰€æœ‰é‡è½½ï¼‰
Â * @param {string} className - Java ç±»çš„å®Œæ•´å
Â */
function hook_all_methods(className) {
Â  Â  Java.perform(function () {
Â  Â  Â  Â  var clazz = Java.use(className);
Â  Â  Â  Â  var methods = clazz.class.getDeclaredMethods(); // åå°„è·å–æ‰€æœ‰å£°æ˜çš„æ–¹æ³•

Â  Â  Â  Â  var hooked = new Set(); // ç”¨äºé¿å…é‡å¤ hook ç›¸åŒæ–¹æ³•åï¼ˆå› ä¸ºå¤šé‡è½½ï¼‰

Â  Â  Â  Â  methods.forEach(function (m) {
Â  Â  Â  Â  Â  Â  var methodName = m.getName();

Â  Â  Â  Â  Â  Â  // å¦‚æœè¿™ä¸ªæ–¹æ³•å·²ç» Hook è¿‡ï¼Œå°±è·³è¿‡
Â  Â  Â  Â  Â  Â  if (hooked.has(methodName)) return;
Â  Â  Â  Â  Â  Â  hooked.add(methodName);

Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  hook_method(className, methodName);
Â  Â  Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  Â  Â  console.error("âŒ Failed to hook " + methodName + ": " + e);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });
}


setImmediate(function () {
Â  Â  hook_all_methods("com.*********.ttnet.retrofit.SsInterceptor");
});


// frida -H 127.0.0.1:1234 -F -l hook_class_methods.js

```

æ—¥å¿—è¾“å‡ºå¦‚ä¸‹ï¼š

```
================= HOOK START =================
ğŸ¯ Class: com.*********.ttnet.retrofit.SsInterceptor
ğŸ”§ Method: tryFilterDupQuery
ğŸ“¥ Arguments:
Â  [0]: https://*************/aweme/v1/search/middle_page_tabs/?need_personal_recommend=*&is_login=*&is_vcd=*&request_tag_from=**&klink_egdi=********************************************************&iid=****************&device_id=****************&ac=****&channel=*******************&aid=****&app_name=*****&version_code=******&version_name=******&device_platform=*******&os=*******&ssmix=*&device_type=*****&device_brand=******&language=**&os_api=**&os_version=**&manifest_version_code=******&resolution=*********&dpi=***&update_version_code=********&_rticket=*************&package=************************&first_launch_timestamp=**********&last_deeplink_update_version_code=*&cpu_support64=****&host_abi=*********&is_guest_mode=*&app_type=******&minor_status=*&appTheme=*****&is_preinstall=*&is_android_pad=*&is_android_fold=*&ts=**********&cdid=************************************ Â  Â Â 
ğŸ“¤ Return value: https://*************/aweme/v1/search/middle_page_tabs/?need_personal_recommend=*&is_login=*&is_vcd=*&request_tag_from=**&klink_egdi=********************************************************&iid=****************&device_id=****************&ac=****&channel=*******************&aid=****&app_name=*****&version_code=******&version_name=******&device_platform=*******&os=*******&ssmix=*&device_type=*****&device_brand=******&language=**&os_api=**&os_version=**&manifest_version_code=******&resolution=*********&dpi=***&update_version_code=********&_rticket=*************&package=************************&first_launch_timestamp=**********&last_deeplink_update_version_code=*&cpu_support64=****&host_abi=*********&is_guest_mode=*&app_type=******&minor_status=*&appTheme=*****&is_preinstall=*&is_android_pad=*&is_android_fold=*&ts=**********&cdid=************************************
================== HOOK END ==================


================= HOOK START =================
ğŸ¯ Class: com.*********.ttnet.retrofit.SsInterceptor
ğŸ”§ Method: intercept
ğŸ“¥ Arguments:
Â  [0]: com.*********.retrofit2.client.Request@1d768f
ğŸ“¤ Return value: com.*********.retrofit2.client.Request@c084623
================== HOOK END ==================


================= HOOK START =================
ğŸ¯ Class: com.*********.ttnet.retrofit.SsInterceptor
ğŸ”§ Method: intercept
ğŸ“¥ Arguments:
Â  [0]: com.*********.retrofit2.client.Request@c084623
Â  [1]: com.*********.retrofit2.SsResponse@2049c2f
ğŸ“¤ Return value: undefined
================== HOOK END ==================

```

ä¸»è¦è°ƒç”¨äº† SsInterceptor çš„ä¸‹é¢ 3 ä¸ªæ–¹æ³•ï¼š

*   â€¢ tryFilterDupQueryï¼šå»é™¤é‡å¤ query å‚æ•°ï¼Œæ„é€ æ–°çš„ URL
    
*   â€¢ intercept(Request request) æ˜¯ â€œè¯·æ±‚æ‹¦æˆªå™¨â€ æ–¹æ³•ï¼Œç”¨äºä¿®æ”¹æˆ–æ›¿æ¢è¯·æ±‚å†…å®¹ï¼Œæ·»åŠ  headersã€åŠ å¯†å‚æ•°ã€ç­¾åç­‰
    
*   â€¢ intercept(Request, SsResponse) æ˜¯ â€œå“åº”æ‹¦æˆªå™¨â€ï¼Œç”¨äºè§‚å¯Ÿæˆ–å¤„ç†ç½‘ç»œå“åº”ï¼ˆå¦‚æ‰“ç‚¹ç»Ÿè®¡ã€å¼‚å¸¸åˆ†æï¼‰ã€‚
    

SsInterceptorã€BaseSsInterceptor ä¸ Interceptor
---------------------------------------------

SsInterceptorã€BaseSsInterceptor ä¸ Interceptor ä¹‹é—´çš„å…³ç³»å¤§æ¦‚å¦‚ä¸‹ï¼š

```
Interceptor (æ¥å£)
Â  Â â†‘
BaseSsInterceptorï¼ˆæŠ½è±¡ç±»/å®ç°ç±»ï¼Œå®ç°äº†ä¸€äº›å…¬å…±é€»è¾‘ï¼‰
Â  Â â†‘
SsInterceptorï¼ˆå®ç°ç±»ï¼Œå®ç°å®é™…è¯·æ±‚æ‹¦æˆªä¸å¤„ç†ï¼‰

```

SsInterceptor ä»£ç åˆ†æ
------------------

```
package com.*********.ttnet.retrofit;

import O.O;
import X.C1465814hj;
import X.C1477714je;
import X.C1478114ji;
import X.C16130FjH;
import android.os.SystemClock;
import android.text.TextUtils;
import android.util.Pair;
import com.GlobalProxyLancet;
import com.*********.common.profilesdk.ProfileManager;
import com.*********.common.utility.StringUtils;
import com.*********.frameworks.baselib.network.http.retrofit.BaseSsInterceptor;
import com.*********.frameworks.baselib.network.http.util.UrlBuilder;
import com.*********.frameworks.baselib.network.http.util.UrlUtils;
import com.*********.frameworks.core.encrypt.RequestEncryptUtils;
import com.*********.qss.common.catcher.CatcherTrace;
import com.*********.retrofit2.RetrofitMetrics;
import com.*********.retrofit2.client.Header;
import com.*********.retrofit2.client.Request;
import com.*********.ttnet.clientkey.ClientKeyManager;
import com.*********.ttnet.http.HttpRequestInfo;
import java.util.ArrayList;
import java.util.Iterator;
import java.util.LinkedHashMap;
import java.util.LinkedHashSet;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;

// SsInterceptorï¼Œç”¨äºå¢å¼ºç½‘ç»œè¯·æ±‚ï¼ŒåŒ…æ‹¬ query å»é‡ã€åŠ å¯†å¤„ç†ã€æ‰“ç‚¹ç»Ÿè®¡ç­‰
public final class SsInterceptor extends BaseSsInterceptor {

Â  Â  // æ˜¯å¦å¯ç”¨ query åŠ å¯†ï¼ˆæ§åˆ¶å¼€å…³ï¼‰
Â  Â  public static volatile boolean sEncryptQueryEnabled;

Â  Â  // æ˜¯å¦å·²æ³¨å…¥ HttpRequestInfoï¼Œä»…æ‰§è¡Œä¸€æ¬¡
Â  Â  public static volatile boolean sHttpInfoInjectedByInterceptor;

Â  Â  // è®¾ç½®æ˜¯å¦å¼€å¯ query åŠ å¯†åŠŸèƒ½
Â  Â  public static void EnableEncryptQuery(boolean z) {
Â  Â  Â  Â  sEncryptQueryEnabled = z;
Â  Â  }

Â  Â  // å»é™¤é‡å¤ query å‚æ•°ï¼Œæ„é€ æ–°çš„ URL
Â  Â  private String tryFilterDupQuery(String str) {
Â  Â  Â  Â  List list;
Â  Â  Â  Â  List list2;
Â  Â  Â  Â  if (StringUtils.isEmpty(str)) {
Â  Â  Â  Â  Â  Â  return str;
Â  Â  Â  Â  }
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  LinkedHashMap linkedHashMap = new LinkedHashMap();
Â  Â  Â  Â  Â  Â  Pair<String, String> parseUrlWithValueList = UrlUtils.parseUrlWithValueList(str, linkedHashMap);
Â  Â  Â  Â  Â  Â  if (parseUrlWithValueList == null) {
Â  Â  Â  Â  Â  Â  Â  Â  return str;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  // å»é‡ query
Â  Â  Â  Â  Â  Â  if (!linkedHashMap.isEmpty()) {
Â  Â  Â  Â  Â  Â  Â  Â  for (Map.Entry entry : linkedHashMap.entrySet()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entry != null && (list2 = (List) entry.getValue()) != null && !list2.isEmpty()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  LinkedHashSet linkedHashSet = new LinkedHashSet();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Iterator it = list2.iterator();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  while (it.hasNext()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  String str2 = (String) it.next();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (linkedHashSet.contains(str2)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  it.remove();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  linkedHashSet.add(str2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  UrlBuilder urlBuilder = new UrlBuilder(O.C((String) parseUrlWithValueList.first, (String) parseUrlWithValueList.second));
Â  Â  Â  Â  Â  Â  if (!linkedHashMap.isEmpty()) {
Â  Â  Â  Â  Â  Â  Â  Â  for (Map.Entry entry2 : linkedHashMap.entrySet()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (entry2 != null && entry2.getKey() != null && (list = (List) entry2.getValue()) != null && !list.isEmpty()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Iterator it2 = list.iterator();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  while (it2.hasNext()) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  urlBuilder.addParam((String) entry2.getKey(), (String) it2.next());
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  return urlBuilder.build();
Â  Â  Â  Â  } catch (Throwable th) {
Â  Â  Â  Â  Â  Â  // å¼‚å¸¸ä¸ŠæŠ¥å¹¶æ‰“å°å †æ ˆ
Â  Â  Â  Â  Â  Â  CatcherTrace.reportThrowable(th, "c.b.ttn.retrofit.SsInterceptor", "tryFilterDupQuery", "java/lang/Throwable", ProfileManager.VERSION);
Â  Â  Â  Â  Â  Â  GlobalProxyLancet.com_ss_android_ugc_aweme_lancet_ThrowableLancet_thrPrintStackTrace(th);
Â  Â  Â  Â  Â  Â  return str;
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // æ‹¦æˆªè¯·æ±‚ï¼šå¯¹ Request åšåŠ å·¥å¤„ç†
Â  Â  @Override
Â  Â  public Request intercept(Request request) {
Â  Â  Â  Â  Request intercept = super.intercept(request); // å…ˆè°ƒç”¨çˆ¶ç±»é€»è¾‘
Â  Â  Â  Â  if (intercept == null) {
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }

Â  Â  Â  Â  // åªæ³¨å…¥ä¸€æ¬¡
Â  Â  Â  Â  if (!sHttpInfoInjectedByInterceptor) {
Â  Â  Â  Â  Â  Â  HttpRequestInfo.injectCreate();
Â  Â  Â  Â  Â  Â  sHttpInfoInjectedByInterceptor = true;
Â  Â  Â  Â  }

Â  Â  Â  Â  long start = SystemClock.uptimeMillis();
Â  Â  Â  Â  Request.Builder newBuilder = intercept.newBuilder();

Â  Â  Â  Â  // å»é‡ query
Â  Â  Â  Â  String filteredUrl = tryFilterDupQuery(intercept.getUrl());
Â  Â  Â  Â  newBuilder.url(filteredUrl);

Â  Â  Â  Â  if (intercept.getMetrics() != null) {
Â  Â  Â  Â  Â  Â  intercept.getMetrics().filterDupQueryDuration = SystemClock.uptimeMillis() - start;
Â  Â  Â  Â  }

Â  Â  Â  Â  long encryptStart = SystemClock.uptimeMillis();
Â  Â  Â  Â  ArrayList<Header> headers = new ArrayList<>();
Â  Â  Â  Â  if (intercept.getHeaders() != null) {
Â  Â  Â  Â  Â  Â  headers.addAll(intercept.getHeaders());
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ˜¯å¦å¯ç”¨ query åŠ å¯†
Â  Â  Â  Â  if (sEncryptQueryEnabled) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  LinkedList<Pair<String, String>> encryptedHeaders = new LinkedList<>();
Â  Â  Â  Â  Â  Â  Â  Â  String encryptedUrl = RequestEncryptUtils.tryEncryptRequest(filteredUrl, encryptedHeaders);
Â  Â  Â  Â  Â  Â  Â  Â  if (encryptedUrl != null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newBuilder.url(encryptedUrl);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  for (Pair pair : encryptedHeaders) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (pair != null) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers.add(new Header((String) pair.first, (String) pair.second));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (Throwable th) {
Â  Â  Â  Â  Â  Â  Â  Â  CatcherTrace.reportThrowable(th, "c.b.ttn.retrofit.SsInterceptor", "int", "java/lang/Throwable", ProfileManager.VERSION);
Â  Â  Â  Â  Â  Â  Â  Â  GlobalProxyLancet.com_ss_android_ugc_aweme_lancet_ThrowableLancet_thrPrintStackTrace(th);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (intercept.getMetrics() != null) {
Â  Â  Â  Â  Â  Â  intercept.getMetrics().encryptRequestDuration = SystemClock.uptimeMillis() - encryptStart;
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ·»åŠ  X-SS-REQ-TICKET è¯·æ±‚å¤´
Â  Â  Â  Â  long ticketStart = SystemClock.uptimeMillis();
Â  Â  Â  Â  String ticket = null;
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  if (C1478114ji.LIZIZ) {
Â  Â  Â  Â  Â  Â  Â  Â  if (C16130FjH.LIZIZ(filteredUrl).getHost().endsWith(C1477714je.LIZ())) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ticket = String.valueOf(System.currentTimeMillis());
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  if (!StringUtils.isEmpty(ticket)) {
Â  Â  Â  Â  Â  Â  Â  Â  headers.add(new Header("X-SS-REQ-TICKET", ticket));
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (Throwable th3) {
Â  Â  Â  Â  Â  Â  CatcherTrace.reportThrowable(th3, "c.b.ttn.retrofit.SsInterceptor", "int", "java/lang/Throwable", ProfileManager.VERSION);
Â  Â  Â  Â  Â  Â  GlobalProxyLancet.com_ss_android_ugc_aweme_lancet_ThrowableLancet_thrPrintStackTrace(th3);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (intercept.getMetrics() != null) {
Â  Â  Â  Â  Â  Â  intercept.getMetrics().genReqTicketDuration = SystemClock.uptimeMillis() - ticketStart;
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ·»åŠ  X-TT-VERIFY-ID è¯·æ±‚å¤´
Â  Â  Â  Â  long verifyStart = SystemClock.uptimeMillis();
Â  Â  Â  Â  if (C1465814hj.LIZ) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  String verifyId = C1465814hj.LIZ(C16130FjH.LIZIZ(filteredUrl));
Â  Â  Â  Â  Â  Â  Â  Â  if (!TextUtils.isEmpty(verifyId)) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers.add(new Header("X-TT-VERIFY-ID", verifyId));
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } catch (Throwable th4) {
Â  Â  Â  Â  Â  Â  Â  Â  CatcherTrace.reportThrowable(th4, "c.b.ttn.retrofit.SsInterceptor", "preProcessingImpl", "java/lang/Throwable", ProfileManager.VERSION);
Â  Â  Â  Â  Â  Â  Â  Â  GlobalProxyLancet.com_ss_android_ugc_aweme_lancet_ThrowableLancet_thrPrintStackTrace(th4);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  if (intercept.getMetrics() != null) {
Â  Â  Â  Â  Â  Â  intercept.getMetrics().preCdnCacheVerifyDuration = SystemClock.uptimeMillis() - verifyStart;
Â  Â  Â  Â  }

Â  Â  Â  Â  // æ·»åŠ  x-bd-client-key ä¸ x-bd-kmsv
Â  Â  Â  Â  ClientKeyManager clientKeyManager = ClientKeyManager.LJFF();
Â  Â  Â  Â  RetrofitMetrics metrics = intercept.getMetrics();
Â  Â  Â  Â  if (ClientKeyManager.LJIIIIZZ != null && ClientKeyManager.LJIIIZ &&
Â  Â  Â  Â  Â  Â  !TextUtils.isEmpty(clientKeyManager.LIZJ) &&
Â  Â  Â  Â  Â  Â  !TextUtils.isEmpty(clientKeyManager.LJFF)) {
Â  Â  Â  Â  Â  Â  long keyStart = SystemClock.uptimeMillis();
Â  Â  Â  Â  Â  Â  headers.add(new Header("x-bd-client-key", clientKeyManager.LIZJ));
Â  Â  Â  Â  Â  Â  headers.add(new Header("x-bd-kmsv", clientKeyManager.LJFF));
Â  Â  Â  Â  Â  Â  if (metrics != null) {
Â  Â  Â  Â  Â  Â  Â  Â  metrics.addClientKeyDuration = SystemClock.uptimeMillis() - keyStart;
Â  Â  Â  Â  Â  Â  Â  Â  metrics.addClientKeySuccess = true;
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  newBuilder.headers(headers);
Â  Â  Â  Â  return newBuilder.build();
Â  Â  }

Â  Â  // å“åº”æ‹¦æˆªæ–¹æ³•
Â  Â  @Override
Â  Â  public void intercept(Request request, com.*********.retrofit2.SsResponse response) {
Â  Â  Â  Â  ...
Â  Â  }
}

```

æ‰€ä»¥ï¼Œé€šè¿‡ hook intercept(Request, SsResponse) æ–¹æ³•å°±å¯ä»¥æ‹¿åˆ°è¯·æ±‚å’Œå“åº”çš„æ•°æ®ã€‚

Request
-------

Request æºç å¦‚ä¸‹ï¼š

```
package com.*********.retrofit2.client;

import com.*********.common.profilesdk.ProfileManager;
import com.*********.memoryx.StringBuilderCache;
import com.*********.qss.common.catcher.CatcherTrace;
import com.*********.retrofit2.OptConfig;
import com.*********.retrofit2.RetrofitMetrics;
import com.*********.retrofit2.Utils;
import com.*********.retrofit2.mime.FormUrlEncodedTypedOutput;
import com.*********.retrofit2.mime.TypedOutput;
import java.net.URI;
import java.net.URISyntaxException;
import java.util.ArrayList;
import java.util.Collections;
import java.util.HashMap;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.List;
import java.util.Map;
import okhttp3.RequestBody;

/* loaded from: base.apk_classes37.jar:com/*********/retrofit2/client/Request.class */
public final class Request {
Â  Â  public final boolean addCommonParam;
Â  Â  public final TypedOutput body;
Â  Â  public final int commonParamLevel;
Â  Â  public Object extraInfo;
Â  Â  public final List<Header> headers;
Â  Â  public boolean isBodyEncryptEnabled;
Â  Â  public boolean isQueryEncryptEnabled;
Â  Â  public final int maxLength;
Â  Â  public final String method;
Â  Â  public RetrofitMetrics metrics;
Â  Â  public final int priorityLevel;
Â  Â  public int queryFilterPriority;
Â  Â  public final RequestBody requestBody;
Â  Â  public final int requestPriorityLevel;
Â  Â  public final boolean responseStreaming;
Â  Â  public final String serviceType;
Â  Â  public final Map<Class<?>, Object> tags;
Â  Â  public URI uri;
Â  Â  public final String url;

Â  Â  ...
Â  Â Â 
}

```

SsResponse
----------

Response æºç å¦‚ä¸‹ï¼š

```
package com.*********.retrofit2;

import com.*********.retrofit2.client.Header;
import com.*********.retrofit2.client.Response;
import com.*********.retrofit2.mime.TypedInput;
import java.util.List;

/* loaded from: base.apk_classes28.jar:com/*********/retrofit2/SsResponse.class */
public final class SsResponse<T> {
Â  Â  public final T body;
Â  Â  public final TypedInput errorBody;
Â  Â  public final Response rawResponse;
Â  Â  public RetrofitMetrics retrofitMetrics;

Â  Â  ...
}

```

smali å±‚æ·±å…¥åˆ†æ
===========

** çš„ java å±‚ä»£ç é‡å®åœ¨å¤ªå¤§äº†ï¼Œç”¨ jadx æ‰“å¼€å†…å­˜ç›´æ¥çˆ†äº†ã€‚

ä½¿ç”¨Â dex2smali[7]Â æŠŠ jar æ‰¹é‡è½¬æ¢ä¸º smali

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXck2siah5w1hww8poYkfIz2R284dxRN13SloDCVTGbaQiaBcIDksIYn3vA/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image2.png

æŠŠ smali æ–‡ä»¶å¤¹å¯¼å…¥ Sublime Textï¼Œå…¨å±€æŸ¥æ‰¾ï¼ˆCtrl + Shift + Fï¼‰"com/google/gson/Gson" ã€‚

æ‰¾åˆ°æ•°æ®è½¬æ¢å·¥å…·ç±» GsonUtils

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXc3RcWKiaghWcWa89pgN7cVk8wDPk2GiagvMdbBXADMwSZriaa8jRrxQMvA/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image3.png

å…¶ä¸­ LIZJ æ–¹æ³•ç”¨äºæŠŠ Object è½¬æ¢ä¸º String

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXcvV81odN2mib2pbk5clfShlBR5mRxN9EgMx3LJTMmLaeiahicBGq0MicfGw/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image4.png

ä½¿ç”¨ Gson æŠŠ body è½¬æ¢æˆ String
=========================

å°è£…ä¸€ä¸ª toJson æ–¹æ³•ä½¿ç”¨ GsonUtils æŠŠ Reqeust Body

```
public final TypedOutput body;

```

å’Œ Response Body

```
public final T body;

```

è½¬æ¢æˆ String

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```
function toJson(obj) {
Â  Â  try {
Â  Â  Â  Â  const GsonUtils = Java.use("com.*********.helios.sdk.utils.GsonUtils");

Â  Â  Â  Â  // ç›´æ¥è°ƒç”¨ LIZJ é™æ€æ–¹æ³•
Â  Â  Â  Â  const jsonString = GsonUtils.LIZJ(obj);

Â  Â  Â  Â  return jsonString ? jsonString.toString() : "";
Â  Â  } catch (err) {
Â  Â  Â  Â  console.error("Error calling GsonUtils.LIZJ:", err);
Â  Â  Â  Â  return "";
Â  Â  }
}

```

ä½¿ç”¨ Frida å®æ—¶æˆªå–è¯·æ±‚å“åº”æ•°æ®
===================

æ‰“å° Request
----------

å°è£…ä¸€ä¸ª printRequest æ–¹æ³•ç”¨äºæ‰“å° Requestï¼š

```
function printRequestContext(context) {
Â  Â  if (!context) return;

Â  Â  const RequestContext = Java.use("com.*********.ttnet.http.RequestContext");
Â  Â  const BaseRequestContext = Java.use("com.*********.frameworks.baselib.network.http.BaseRequestContext");

Â  Â  const ctx = Java.cast(context, RequestContext);

Â  Â  const sb = [];

Â  Â  // ğŸ”· RequestContext è‡ªèº«å­—æ®µ
Â  Â  sb.push("ğŸ§© RequestContext:");
Â  Â  sb.push(` Â - body_is_json: ${ctx.body_is_json.value}`);
Â  Â  sb.push(` Â - cdn_request_num: ${ctx.cdn_request_num.value}`);
Â  Â  sb.push(` Â - decode_time: ${ctx.decode_time.value}`);
Â  Â  sb.push(` Â - force_no_https: ${ctx.force_no_https.value}`);
Â  Â  sb.push(` Â - https_fail_times: ${ctx.https_fail_times.value}`);
Â  Â  sb.push(` Â - https_to_http: ${ctx.https_to_http.value}`);
Â  Â  sb.push(` Â - local_sign: ${ctx.local_sign.value}`);
Â  Â  sb.push(` Â - ss_sign: ${ctx.ss_sign.value}`);
Â  Â  sb.push(` Â - using_https: ${ctx.using_https.value}`);

Â  Â  // headers æ˜¯ JSONObjectï¼Œéœ€è¦è½¬æ¢æˆå­—ç¬¦ä¸²æ‰“å°
Â  Â  const headers = ctx.headers.value;
Â  Â  if (headers !== null) {
Â  Â  Â  Â  sb.push(` Â - headers: ${headers.toString()}`);
Â  Â  } else {
Â  Â  Â  Â  sb.push(` Â - headers: null`);
Â  Â  }

Â  Â  // ğŸ”¶ BaseRequestContext çˆ¶ç±»å­—æ®µ
Â  Â  const baseCtx = Java.cast(context, BaseRequestContext);
Â  Â  sb.push("ğŸ”¹ BaseRequestContext:");

Â  Â  const tryGet = (fieldName) => {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  return baseCtx[fieldName].value;
Â  Â  Â  Â  } catch (e) {
Â  Â  Â  Â  Â  Â  return "<error>";
Â  Â  Â  Â  }
Â  Â  };

Â  Â  sb.push(` Â - authCredentials: ${tryGet('authCredentials')}`);
Â  Â  sb.push(` Â - byPassProxy: ${tryGet('byPassProxy')}`);
Â  Â  sb.push(` Â - bypassCookie: ${tryGet('bypassCookie')}`);
Â  Â  sb.push(` Â - enable_http_cache: ${tryGet('enable_http_cache')}`);
Â  Â  sb.push(` Â - force_handle_response: ${tryGet('force_handle_response')}`);
Â  Â  sb.push(` Â - force_use_okhttp: ${tryGet('force_use_okhttp')}`);
Â  Â  sb.push(` Â - ignoreCheckMinInputStreamBufferSize: ${tryGet('ignoreCheckMinInputStreamBufferSize')}`);
Â  Â  sb.push(` Â - input_stream_buffer_size: ${tryGet('input_stream_buffer_size')}`);
Â  Â  sb.push(` Â - isCustomizedCookie: ${tryGet('isCustomizedCookie')}`);
Â  Â  sb.push(` Â - okHttpRequestClientBuilderHook: ${tryGet('okHttpRequestClientBuilderHook')}`);
Â  Â  sb.push(` Â - output_stream_buffer_size: ${tryGet('output_stream_buffer_size')}`);
Â  Â  sb.push(` Â - protect_timeout: ${tryGet('protect_timeout')}`);
Â  Â  sb.push(` Â - read_error_response: ${tryGet('read_error_response')}`);
Â  Â  sb.push(` Â - remoteIp: ${tryGet('remoteIp')}`);
Â  Â  sb.push(` Â - request_flag: ${tryGet('request_flag')}`);
Â  Â  sb.push(` Â - request_type_flags: ${tryGet('request_type_flags')}`);
Â  Â  sb.push(` Â - rotationHostRetryInfoList: ${tryGet('rotationHostRetryInfoList')}`);
Â  Â  sb.push(` Â - socket_connect_timeout: ${tryGet('socket_connect_timeout')}`);
Â  Â  sb.push(` Â - socket_read_timeout: ${tryGet('socket_read_timeout')}`);
Â  Â  sb.push(` Â - socket_write_timeout: ${tryGet('socket_write_timeout')}`);
Â  Â  sb.push(` Â - status: ${tryGet('status')}`);
Â  Â  sb.push(` Â - streaming_force_return_response: ${tryGet('streaming_force_return_response')}`);
Â  Â  sb.push(` Â - throttle_net_speed: ${tryGet('throttle_net_speed')}`);
Â  Â  sb.push(` Â - timeout_connect: ${tryGet('timeout_connect')}`);
Â  Â  sb.push(` Â - timeout_read: ${tryGet('timeout_read')}`);
Â  Â  sb.push(` Â - timeout_write: ${tryGet('timeout_write')}`);
Â  Â  sb.push(` Â - bypass_network_status_check: ${tryGet('bypass_network_status_check')}`);
Â  Â  sb.push(` Â - followRedirectInternal: ${tryGet('followRedirectInternal')}`);
Â  Â  sb.push(` Â - is_need_monitor_in_cancel: ${tryGet('is_need_monitor_in_cancel')}`);
Â  Â  sb.push(` Â - extraInfo: ${tryGet('extraInfo')}`);

Â  Â  return sb.join("\n");
}


function printRequest(req) {
Â  Â  if (!req) return 'âš ï¸ Request is null';

Â  Â  const Request = Java.use('com.*********.retrofit2.client.Request');
Â  Â  const Header = Java.use('com.*********.retrofit2.client.Header');

Â  Â  const realReq = Java.cast(req, Request);
Â  Â  const sb = [];

Â  Â  sb.push('=== ğŸ“¦ Request Dump Start ===');
Â  Â  sb.push('â¡ï¸ Method: ' + realReq.getMethod());
Â  Â  sb.push('ğŸŒ URL: ' + realReq.getUrl());
Â  Â  sb.push('ğŸ“Œ Path: ' + realReq.getPath());
Â  Â  sb.push('ğŸ” QueryEncrypt: ' + realReq.isQueryEncryptEnabled());
Â  Â  sb.push('ğŸ” BodyEncrypt: ' + realReq.isBodyEncryptEnabled());
Â  Â  sb.push('ğŸ“Š PriorityLevel: ' + realReq.getPriorityLevel());
Â  Â  sb.push('âš™ï¸ ServiceType: ' + realReq.getServiceType());

Â  Â  // ğŸ§¾ Headers
Â  Â  const headers = realReq.getHeaders();
Â  Â  if (headers && headers.size() > 0) {
Â  Â  Â  Â  sb.push('ğŸ§¾ Headers:');
Â  Â  Â  Â  for (let i = 0; i < headers.size(); i++) {
Â  Â  Â  Â  Â  Â  const h = Java.cast(headers.get(i), Header);
Â  Â  Â  Â  Â  Â  sb.push(` Â - ${h.getName()}: ${h.getValue()}`);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // ğŸ“¦ Body info
Â  Â  const body = realReq.getBody();
Â  Â  if (body) {
Â  Â  Â  Â  sb.push('ğŸ“¦ Body mimeType: ' + body.mimeType());
Â  Â  Â  Â  sb.push('ğŸ“¦ Body length: ' + body.length());
Â  Â  Â  Â  sb.push('ğŸ“¦ Body.toString(): ' + body.toString());
Â  Â  Â  Â  sb.push('ğŸ“¦ Body: ' + toJson(body));
Â  Â  }

Â  Â  // ğŸ·ï¸ Tag
Â  Â  const tag = realReq.tag();
Â  Â  if (tag) {
Â  Â  Â  Â  sb.push('ğŸ·ï¸ Tag: ' + tag.toString());
Â  Â  }

Â  Â  // ğŸ“¦ ExtraInfo åˆ¤æ–­ç±»å‹
Â  Â  const extraInfo = realReq.getExtraInfo();
Â  Â  if (extraInfo) {
Â  Â  Â  Â  const className = extraInfo.getClass().getName();
Â  Â  Â  Â  sb.push('ğŸ“¦ ExtraInfo class: ' + className);
Â  Â  Â  Â  if (extraInfo.getClass().getName().startsWith("com.*********.ttnet.http.RequestContext")) {
Â  Â  Â  Â  Â  Â  sb.push(printRequestContext(extraInfo));
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  sb.push('ğŸ“¦ ExtraInfo.toString(): ' + extraInfo.toString());
Â  Â  Â  Â  }
Â  Â  }

Â  Â  sb.push('=== âœ… Request Dump End ===');
Â  Â  return sb.join('\n');
}

```

æ‰“å° SsResponse
-------------

å°è£…ä¸€ä¸ª printSsResponse æ–¹æ³•ç”¨äºæ‰“å° SsResponseï¼š

```
function printSsResponse(resp) {
Â  Â  if (!resp) return 'âš ï¸ SsResponse is null';

Â  Â  const SsResponse = Java.use('com.*********.retrofit2.SsResponse');
Â  Â  // const Response = Java.use('com.*********.retrofit2.client.Response');
Â  Â  const Header = Java.use('com.*********.retrofit2.client.Header');
Â  Â  // const TypedInput = Java.use('com.*********.retrofit2.mime.TypedInput');

Â  Â  const ssResp = Java.cast(resp, SsResponse);
Â  Â  const rawResp = ssResp.raw(); // com.*********.retrofit2.client.Response

Â  Â  const sb = [];
Â  Â  sb.push('=== ğŸ“¥ SsResponse Dump Start ===');

Â  Â  sb.push('âœ… isSuccessful: ' + ssResp.isSuccessful());
Â  Â  sb.push('ğŸ”¢ Code: ' + ssResp.code());
Â  Â  sb.push('ğŸ“ Message: ' + ssResp.message());

Â  Â  // Headers
Â  Â  const headers = ssResp.headers();
Â  Â  if (headers && headers.size() > 0) {
Â  Â  Â  Â  sb.push('ğŸ§¾ Headers:');
Â  Â  Â  Â  for (let i = 0; i < headers.size(); i++) {
Â  Â  Â  Â  Â  Â  const h = Java.cast(headers.get(i), Header);
Â  Â  Â  Â  Â  Â  sb.push(` Â - ${h.getName()}: ${h.getValue()}`);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  // Body
Â  Â  const body = ssResp.body();
Â  Â  if (body) {
Â  Â  Â  Â  sb.push('ğŸ“¦ Body.toString(): ' + body.toString());
Â  Â  Â  Â  sb.push('ğŸ“¦ Body: ' + toJson(body));
Â  Â  }

Â  Â  // Error body
Â  Â  const errorBody = ssResp.errorBody();
Â  Â  if (errorBody) {
Â  Â  Â  Â  sb.push('â— ErrorBody mimeType: ' + errorBody.mimeType());
Â  Â  Â  Â  sb.push('â— ErrorBody length: ' + errorBody.length());
Â  Â  }

Â  Â  // RetrofitMetrics
Â  Â  const metrics = ssResp.getRetrofitMetrics();
Â  Â  if (metrics) {
Â  Â  Â  Â  sb.push('ğŸ“ˆ RetrofitMetrics: ' + metrics.toString());
Â  Â  }

Â  Â  sb.push('=== ğŸ“¥ SsResponse Dump End ===');
Â  Â  // console.log(sb.join('\n'));
Â  Â  return sb.join('\n');
}

```

Hook intercept(Request, SsResponse)
-----------------------------------

ä½¿ç”¨ Frida Hook intercept(Request, SsResponse) æˆªå–è¯·æ±‚å’Œå“åº”æ•°æ®ã€‚

ttnet.js

```
function hookSsInterceptor() {
Â  Â  ***************************************************************************
Â  Â  // Hookç›®æ ‡ç±»
Â  Â  *********************************************************
Â  Â  ********************************************************************************************************************
Â  Â  Â  Â  *****************************************

Â  Â  Â  Â  **************
Â  Â  Â  Â  Â  Â  **************************************
Â  Â  Â  Â  Â  Â  *******************
Â  Â  Â  Â  Â  Â  ***********************
Â  Â  Â  Â  Â  Â  ****************************
Â  Â  Â  Â  **************

Â  Â  Â  Â  // ç›´æ¥æ‰“å°æ—¥å¿—
Â  Â  Â  Â  // console.log(log);

Â  Â  Â  Â  // âœ… å°†æ—¥å¿—å‘é€ç»™ Python ç«¯è€Œä¸æ˜¯ console.log
Â  Â  Â  Â  *******
Â  Â  Â  Â  Â  Â  *********************
Â  Â  Â  Â  Â  Â  *************
Â  Â  Â  Â  ****

Â  Â  Â  Â  **********************************
Â  Â  ***
}


setImmediate(() => {
Â  Â  Java.perform(function () {
Â  Â  Â  Â  hookSsInterceptor()
Â  Â  });
})


// frida -H 127.0.0.1:1234 -F -l ttnet.js
// frida -H 127.0.0.1:1234 -F -l ttnet.js -o log.txt

```

åœ¨ Python ç«¯æ¥æ”¶åˆ°æ•°æ®å¹¶è¾“å‡ºåˆ° log.txt

ttnet.py

```
import time

import frida

LOG_FILE = "log.txt"

def on_message(message, data):
Â  Â  if message["type"] == "send":
Â  Â  Â  Â  tag = message["payload"].get("tag")
Â  Â  Â  Â  log = message["payload"].get("payload")
Â  Â  Â  Â  if tag == "ss_intercept":
Â  Â  Â  Â  Â  Â  with open(LOG_FILE, "w", encoding="utf-8") as f:
Â  Â  Â  Â  Â  Â  Â  Â  f.write(f"{log}\n\n")
Â  Â  elif message["type"] == "error":
Â  Â  Â  Â  print("âŒ Frida script error:", message["stack"])

def main():
Â  Â  # USBé“¾æ¥
Â  Â  # device: frida.core.Device = frida.get_usb_device()

Â  Â  # è¿œç¨‹é“¾æ¥
Â  Â  device = frida.get_device_manager().add_remote_device("127.0.0.1:1234")

Â  Â  # é™„åŠ åˆ°å½“å‰å‰å°åº”ç”¨
Â  Â  pid = device.get_frontmost_application().pid
Â  Â  session: frida.core.Session = device.attach(pid)

Â  Â  # åŠ è½½è„šæœ¬
Â  Â  with open("ttnet.js", "r", encoding="utf-8") as f:
Â  Â  Â  Â  script = session.create_script(f.read())

Â  Â  script.on("message", on_message)
Â  Â  script.load()

Â  Â  print(f"âœ… Script loaded and logging to {LOG_FILE}")
Â  Â  try:
Â  Â  Â  Â  while True:
Â  Â  Â  Â  Â  Â  time.sleep(1)
Â  Â  except KeyboardInterrupt:
Â  Â  Â  Â  print("\nğŸ‘‹ Exit by user.")

if __name__ == "__main__":
Â  Â  main()

```

æµ‹è¯•
--

æˆªå–ä¸‹æ¥çš„æ•°æ®å¦‚ä¸‹ï¼ŒReqeust Body æ˜¯ç»è¿‡ç¼–ç åŠ å¯†çš„äºŒè¿›åˆ¶æ•°æ®ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXc74icWzy87PQwia23CdnynTpqzSwJn99yI1BS4Hrsp18r0tcDWc183Weg/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image5.png

åŠ å¯†å­—æ®µçš„è§£ç ä¸æ•°æ®è¿˜åŸ
============

æ•°æ®æ ¼å¼è¯´æ˜
------

```
{
Â  Â  "content": {
Â  Â  Â  Â  "buf": [40, -75, Â ...],
Â  Â  Â  Â  "count": 3509
Â  Â  },
Â  Â  "enableRecordFields": false,
Â  Â  "fields": {},
Â  Â  "mBodyMd5Stub": "27237ACA0C**********BEBD640337",
Â  Â  "mIsBodyEncrypted": false,
Â  Â  "mOriginBodySize": 13440,
Â  Â  "mType": "zstd"
}

```

content.buf æ˜¯ä¸€ä¸ª byte æ•°ç»„ï¼ŒåŒ…å«å­—èŠ‚å€¼ï¼ˆèŒƒå›´ -128 åˆ° 127ï¼‰ï¼Œè¿™æ˜¯ Java çš„ byte[] é€šè¿‡ Gson åºåˆ—åŒ–åçš„è¡¨ç°å½¢å¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ Python å°†å®ƒè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„åå†è§£ç æˆå­—ç¬¦ä¸²ã€‚

è¯¥æ•°æ®ç»“æ„çš„å®é™…ç±»å‹æ˜¯ FormUrlEncodedTypedOutputï¼ŒJava æºç å¦‚ä¸‹ï¼š

```
package com.*********.retrofit2.mime;

import com.*********.common.profilesdk.ProfileManager;
import com.*********.frameworks.encryptor.EncryptorUtil;
import com.*********.qss.common.catcher.CatcherTrace;
import com.*********.retrofit2.mime.TTRequestCompressManager;
import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.OutputStream;
import java.net.URLEncoder;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import leakcanary.internal.LeakCanaryFileProvider;

/* loaded from: base.apk_classes37.jar:com/*********/retrofit2/mime/FormUrlEncodedTypedOutput.class */
public final class FormUrlEncodedTypedOutput extends AbsTypedOutput {
Â  Â  public ByteArrayOutputStream content;
Â  Â  public final boolean enableRecordFields;
Â  Â  public final Map<String, List<String>> fields;

Â  Â  public FormUrlEncodedTypedOutput() {
Â  Â  Â  Â  this.content = new ByteArrayOutputStream();
Â  Â  Â  Â  this.fields = new HashMap();
Â  Â  Â  Â  this.enableRecordFields = false;
Â  Â  }

Â  Â  public FormUrlEncodedTypedOutput(boolean z) {
Â  Â  Â  Â  this.content = new ByteArrayOutputStream();
Â  Â  Â  Â  this.fields = new HashMap();
Â  Â  Â  Â  this.enableRecordFields = z;
Â  Â  }

Â  Â  public void addField(String str, String str2) {
Â  Â  Â  Â  addField(str, true, str2, true);
Â  Â  }

Â  Â  public void addField(String str, boolean z, String str2, boolean z2) {
Â  Â  Â  Â  if (str == null) {
Â  Â  Â  Â  Â  Â  throw new NullPointerException(LeakCanaryFileProvider.ATTR_NAME);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (str2 == null) {
Â  Â  Â  Â  Â  Â  throw new NullPointerException("value");
Â  Â  Â  Â  }
Â  Â  Â  Â  if (this.content.size() > 0) {
Â  Â  Â  Â  Â  Â  this.content.write(38);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (this.enableRecordFields) {
Â  Â  Â  Â  Â  Â  if (this.fields.containsKey(str)) {
Â  Â  Â  Â  Â  Â  Â  Â  this.fields.get(str).add(str2);
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  ArrayList arrayList = new ArrayList();
Â  Â  Â  Â  Â  Â  Â  Â  arrayList.add(str2);
Â  Â  Â  Â  Â  Â  Â  Â  this.fields.put(str, arrayList);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  String str3 = str;
Â  Â  Â  Â  if (z) {
Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  str3 = URLEncoder.encode(str, "UTF-8");
Â  Â  Â  Â  Â  Â  } catch (IOException e) {
Â  Â  Â  Â  Â  Â  Â  Â  CatcherTrace.reportThrowable(e, "c.b.ret.mim.FormUrlEncodedTypedOutput", "afie", "java/io/IOException", ProfileManager.VERSION);
Â  Â  Â  Â  Â  Â  Â  Â  throw new RuntimeException(e);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  String str4 = str2;
Â  Â  Â  Â  if (z2) {
Â  Â  Â  Â  Â  Â  str4 = URLEncoder.encode(str2, "UTF-8");
Â  Â  Â  Â  }
Â  Â  Â  Â  this.content.write(str3.getBytes("UTF-8"));
Â  Â  Â  Â  this.content.write(61);
Â  Â  Â  Â  this.content.write(str4.getBytes("UTF-8"));
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public TTRequestCompressManager.CompressData compressRequestBody(String str, String str2, boolean z) {
Â  Â  Â  Â  byte[] byteArray = this.content.toByteArray();
Â  Â  Â  Â  if (byteArray == null) {
Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  }
Â  Â  Â  Â  TTRequestCompressManager.CompressData compressBody = TTRequestCompressManager.compressBody(byteArray, byteArray.length, str, str2, z);
Â  Â  Â  Â  if (compressBody != null && compressBody.data != null) {
Â  Â  Â  Â  Â  Â  this.mOriginBodySize = byteArray.length;
Â  Â  Â  Â  Â  Â  ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(compressBody.data.length);
Â  Â  Â  Â  Â  Â  this.content = byteArrayOutputStream;
Â  Â  Â  Â  Â  Â  byte[] bArr = compressBody.data;
Â  Â  Â  Â  Â  Â  byteArrayOutputStream.write(bArr, 0, bArr.length);
Â  Â  Â  Â  Â  Â  this.mType = compressBody.contentEncoding;
Â  Â  Â  Â  }
Â  Â  Â  Â  return compressBody;
Â  Â  }

Â  Â  public Map<String, List<String>> fields() {
Â  Â  Â  Â  return this.fields;
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public String fileName() {
Â  Â  Â  Â  return null;
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public byte[] getOriginBody() {
Â  Â  Â  Â  return TTRequestCompressManager.decompressDataByType(this.content.toByteArray(), this.mType, this.mOriginBodySize);
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public boolean interceptRequestBody() {
Â  Â  Â  Â  byte[] LIZ;
Â  Â  Â  Â  byte[] byteArray = this.content.toByteArray();
Â  Â  Â  Â  if (byteArray == null || byteArray.length > 102400 || (LIZ = EncryptorUtil.LIZ(byteArray, byteArray.length)) == null) {
Â  Â  Â  Â  Â  Â  return false;
Â  Â  Â  Â  }
Â  Â  Â  Â  ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(LIZ.length);
Â  Â  Â  Â  this.content = byteArrayOutputStream;
Â  Â  Â  Â  byteArrayOutputStream.write(LIZ, 0, LIZ.length);
Â  Â  Â  Â  this.mIsBodyEncrypted = true;
Â  Â  Â  Â  return true;
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public long length() {
Â  Â  Â  Â  return this.content.size();
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public String md5Stub() {
Â  Â  Â  Â  this.mBodyMd5Stub = DigestUtil.md5Hex(this.content.toByteArray());
Â  Â  Â  Â  return this.mBodyMd5Stub;
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public String mimeType() {
Â  Â  Â  Â  return "application/x-www-form-urlencoded; charset=UTF-8";
Â  Â  }

Â  Â  @Override // com.*********.retrofit2.mime.AbsTypedOutput
Â  Â  public void writeTo(OutputStream outputStream) {
Â  Â  Â  Â  outputStream.write(this.content.toByteArray());
Â  Â  }
}

```

buf è§£ç 
------

è¿™æ˜¯ Retrofit å‘é€çš„è¯·æ±‚ä½“ä¸­çš„å†…å®¹ï¼Œé‚£ä¹ˆ buf å®é™…æ˜¯å‹ç¼©åçš„äºŒè¿›åˆ¶æ•°æ®ï¼ˆæ³¨æ„ "mType": "zstd" è¡¨ç¤ºä½¿ç”¨äº† zstd å‹ç¼©ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦ï¼š

1.  1. æŠŠ buf è¿˜åŸä¸º Uint8Array æˆ– Bufferã€‚
    
2.  2. ä½¿ç”¨ zstd è§£å‹ã€‚
    
3.  3. ç„¶åè§£ç ä¸ºå­—ç¬¦ä¸²ï¼ˆå¦‚ UTF-8ï¼‰ã€‚
    
4.  4. ä½¿ç”¨ URL è§£ç 
    

zstdï¼ˆZstandardï¼‰[8] æ˜¯ç”± Facebook å¼€å‘çš„ä¸€ç§ æ— æŸå‹ç¼©ç®—æ³•ï¼Œè®¾è®¡ç›®æ ‡æ˜¯æä¾›ï¼š

*   â€¢ æ¯” zlib æ›´å¥½çš„å‹ç¼©æ¯”
    
*   â€¢ æ›´å¿«çš„å‹ç¼©å’Œè§£å‹é€Ÿåº¦
    

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```
import zstandard
from urllib.parse import unquote


def decode_zstd_buf_to_text(buf):
Â  Â  """
Â  Â  å°† Retrofit ä¸­ FormUrlEncodedTypedOutput çš„ content.buf è§£ç ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²

Â  Â  å‚æ•°:
Â  Â  Â  Â  buf (List[int]): è¡¨ç¤º zstd å‹ç¼©åçš„å­—èŠ‚æ•°ç»„ï¼ˆæœ‰ç¬¦å· intï¼‰

Â  Â  è¿”å›:
Â  Â  Â  Â  str: è§£å‹ç¼©åçš„æ–‡æœ¬å†…å®¹
Â  Â  """
Â  Â  # å°† buf è½¬æ¢ä¸º bytes ç±»å‹ï¼ˆæœ‰ç¬¦å· int8 è½¬æ¢ä¸ºæ— ç¬¦å·ï¼‰
Â  Â  *******************************************************

Â  Â  # ä½¿ç”¨ zstandard è§£å‹
Â  Â  ************************************
Â  Â  *************************************************

Â  Â  # è§£ç ä¸ºå­—ç¬¦ä¸²ï¼ˆå‡è®¾ utf-8 ç¼–ç ï¼‰
Â  Â  ************************************

Â  Â  # URL è§£ç 
Â  Â  ********************************
Â  Â Â 
Â  Â  ***********************

```

buf å­—æ®µè¿˜åŸå¹¶é‡å†™
-----------

ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ Python å‡½æ•°ï¼Œå¯ä»¥ï¼š

1.  1. è¯»å– txt æ–‡ä»¶å†…å®¹
    
2.  2. è¯†åˆ«åŒ…å« buf: [æ•°ç»„] çš„å­—æ®µ
    
3.  3. è§£ç  buf ä¸­çš„ byte æ•°ç»„å¹¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²
    
4.  4. æ›¿æ¢åŸå§‹ buf å­—æ®µä¸ºå¯è¯»å­—ç¬¦ä¸²
    
5.  5. è¦†ç›–å†™å›åŸå§‹ txt æ–‡ä»¶
    

å®Œæ•´ä»£ç å®ç°å¦‚ä¸‹ï¼š

```
import re

import zstandard


def decode_zstd_buf_to_text(buf):
Â  Â  """
Â  Â  å°† Retrofit ä¸­ FormUrlEncodedTypedOutput çš„ content.buf è§£ç ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²

Â  Â  å‚æ•°:
Â  Â  Â  Â  buf (List[int]): è¡¨ç¤º zstd å‹ç¼©åçš„å­—èŠ‚æ•°ç»„ï¼ˆæœ‰ç¬¦å· intï¼‰

Â  Â  è¿”å›:
Â  Â  Â  Â  str: è§£å‹ç¼©åçš„æ–‡æœ¬å†…å®¹
Â  Â  """
Â  Â  # å°† buf è½¬æ¢ä¸º bytes ç±»å‹ï¼ˆæœ‰ç¬¦å· int8 è½¬æ¢ä¸ºæ— ç¬¦å·ï¼‰
Â  Â  *******************************************************

Â  Â  # ä½¿ç”¨ zstandard è§£å‹
Â  Â  ************************************
Â  Â  *************************************************

Â  Â  # è§£ç ä¸ºå­—ç¬¦ä¸²ï¼ˆå‡è®¾ utf-8 ç¼–ç ï¼‰
Â  Â  ************************************


def decode_buf_array(match):
Â  Â  **************************
Â  Â  # æå–æ‰€æœ‰æ•´æ•°ï¼ˆæ”¯æŒè´Ÿæ•°ï¼‰
Â  Â  *************************************************************************
Â  Â  # è§£ç 
Â  Â  ***********************************************
Â  Â  *****************************


def replace_buf_array_with_string(file_path: str, encoding='utf-8'):
Â  Â  """
Â  Â  è‡ªåŠ¨å°†æ–‡ä»¶ä¸­ç±»ä¼¼ "buf":[40, -75, 47, ...] çš„å†…å®¹è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ›¿æ¢åŸ buf å€¼ã€‚

Â  Â  :param file_path: txt æ–‡ä»¶è·¯å¾„
Â  Â  :param encoding: è¯»å–ä¸å†™å…¥æ—¶çš„ç¼–ç ï¼ˆé»˜è®¤ utf-8ï¼‰
Â  Â  """
Â  Â  ***************************************************
Â  Â  Â  Â  *******************

Â  Â  # æ­£åˆ™åŒ¹é… buf: [xx, xx, ...] çš„ç»“æ„ï¼Œæ”¯æŒè·¨è¡Œ
Â  Â  ***********************************

Â  Â  # æ›¿æ¢æ‰€æœ‰åŒ¹é…çš„ buf å­—æ®µ
Â  Â  **************************************************************************

Â  Â  # å†™å›åŸæ–‡ä»¶
Â  Â  ***************************************************
Â  Â  Â  Â  *********************

Â  Â  *****************************


if __name__ == '__main__':
Â  Â  replace_buf_array_with_string('log1.txt')

```

æˆåŠŸè¿˜åŸ buf å­—æ®µæ•°æ®ã€‚

![](https://mmbiz.qpic.cn/sz_mmbiz_png/hibUrj5WA1jl8N0d0k9apicF6mWHCIqmXclKx8ZsAgblguLj6UwUVyq8Tz3GBPAQ9MPjtmibmIYHKYCBWsxia44OYw/640?wx_fmt=png&from=appmsg&watermark=1)word/media/image6.png

#### å¼•ç”¨é“¾æ¥

`[1]`Â å¦‚ä½•å®ç° Android App çš„æŠ“åŒ…é˜²æŠ¤ï¼Ÿåˆè¯¥å¦‚ä½•ç»•è¿‡ï¼Ÿä¸€æ–‡çœ‹æ‡‚æ”»é˜²åšå¼ˆ:_https://cyrus-studio.github.io/blog/posts/%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0-android-app-%E7%9A%84%E6%8A%93%E5%8C%85%E9%98%B2%E6%8A%A4%E5%8F%88%E8%AF%A5%E5%A6%82%E4%BD%95%E7%BB%95%E8%BF%87%E4%B8%80%E6%96%87%E7%9C%8B%E6%87%82%E6%94%BB%E9%98%B2%E5%8D%9A%E5%BC%88/_  
`[2]`å®‰å“æŠ“åŒ…å®æˆ˜ï¼šä½¿ç”¨ Charles æŠ“å– App æ•°æ®å…¨æµç¨‹è¯¦è§£:_https://cyrus-studio.github.io/blog/posts/%E5%AE%89%E5%8D%93%E6%8A%93%E5%8C%85%E5%AE%9E%E6%88%98%E4%BD%BF%E7%94%A8-charles-%E6%8A%93%E5%8F%96-app-%E6%95%B0%E6%8D%AE%E5%85%A8%E6%B5%81%E7%A8%8B%E8%AF%A6%E8%A7%A3/_  
`[3]`frida_dex_dump:_https://github.com/CYRUS-STUDIO/frida_dex_dump_  
`[4]`dex2jar:_https://github.com/CYRUS-STUDIO/dex2jar_  
`[5]`find_in_jars.py:_https://github.com/CYRUS-STUDIO/dex2jar/blob/main/find_in_jars.py_  
`[6]`æ‰“é€ è‡ªå·±çš„ Jar æ–‡ä»¶åˆ†æå·¥å…·ï¼šç±»ååŒ¹é… + äºŒè¿›åˆ¶æœç´¢ + æ—¥å¿—è¾“å‡ºå…¨æå®š:_https://cyrus-studio.github.io/blog/posts/%E6%89%93%E9%80%A0%E8%87%AA%E5%B7%B1%E7%9A%84-jar-%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%E7%B1%BB%E5%90%8D%E5%8C%B9%E9%85%8D-+-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%90%9C%E7%B4%A2-+-%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA%E5%85%A8%E6%90%9E%E5%AE%9A/_  
`[7]`dex2smali:_https://github.com/CYRUS-STUDIO/dex2smali_  
`[8]`zstdï¼ˆZstandardï¼‰:_https://github.com/facebook/zstd_